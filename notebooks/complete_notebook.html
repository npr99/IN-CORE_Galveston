

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Example: Galveston Testbed &#8212; Galveston Notebook Gallery</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/complete_notebook';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo_galveston.png" class="logo__image only-light" alt="Galveston Notebook Gallery - Home"/>
    <script>document.write(`<img src="../_static/logo_galveston.png" class="logo__image only-dark" alt="Galveston Notebook Gallery - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Galveston Notebook Gallery
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Example Simulation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="prerequisites.html">1. Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="electric_power_pole_damage.html">3. Electric Power Pole Damage</a></li>
<li class="toctree-l1"><a class="reference internal" href="monte_carlo_sampling.html">4. Monte Carlo sampling</a></li>
<li class="toctree-l1"><a class="reference internal" href="building_functionality.html">5. Building functionality</a></li>
<li class="toctree-l1"><a class="reference internal" href="capital_shock.html">6. Capital Shocks</a></li>
<li class="toctree-l1"><a class="reference internal" href="population_dislocation.html">7. Population dislocation - Multihazard Comparison</a></li>
<li class="toctree-l1"><a class="reference internal" href="housing_household_recovery.html">8. Housing Houshold Recovery Sequentials</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Extra Notebooks</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="extra_notebooks/Galveston_testbed_2022-09-19.html">Galveston Testbed (previous version)</a></li>









<li class="toctree-l1"><a class="reference internal" href="extra_notebooks/01_Damage_Buildings/BuildingDamage_Tori_05_18_22.html">Building Damage</a></li>

<li class="toctree-l1"><a class="reference internal" href="extra_notebooks/01_Damage_Electric%20Power/WoodPolesDamage_05_23_22.html">Wood Pole Damage</a></li>

<li class="toctree-l1"><a class="reference internal" href="extra_notebooks/01_Damage_Electric%20Power_Prestressed%20poles/PrestressedPolesDamage_05_23_22.html">Prestressed Pole Damage</a></li>

<li class="toctree-l1"><a class="reference internal" href="extra_notebooks/01_Damage_Electric%20Power_Substations/SubstationDamage_05_23_22.html">Substation Damage</a></li>

<li class="toctree-l1"><a class="reference internal" href="extra_notebooks/01_Damage_Electric%20Power_Towers/TowerDamage_05_23_22.html">Tower Damage</a></li>

<li class="toctree-l1"><a class="reference internal" href="extra_notebooks/01_Damage_Electric%20Power_WoodPoles/WoodPolesDamage_05_23_22.html">Wood Pole Damage</a></li>

<li class="toctree-l1"><a class="reference internal" href="extra_notebooks/02_Damage_EPNAnalysis/EPN_NetworkAnalysis_05_23_22.html">EPN Network Analysis</a></li>

<li class="toctree-l1"><a class="reference internal" href="extra_notebooks/03_AdditionalNotebooks/Nearest%20neighbor%20analysis_Poles%20and%20Buildings/PolesBldgsNearestNeighbor_05_23_22.html">Pole-Building Assignment</a></li>
<li class="toctree-l1"><a class="reference internal" href="extra_notebooks/01_Damage_Transportation_Bridges/BridgesDamage_05_18_22.html">Bridge Damage</a></li>

<li class="toctree-l1"><a class="reference internal" href="extra_notebooks/01_Damage_Transportation_Roadways/RoadwaysDamage_05_18_22.html">Roadway Damage</a></li>

<li class="toctree-l1"><a class="reference internal" href="extra_notebooks/03_Social_PopulationDislocationAnalysis/PopulationDisAnalysis_05_31_22.html">Population Dislocation Analysis</a></li>





</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/npr99/IN-CORE_Galveston.git/HEAD/v2/gh/npr99/IN-CORE_Galveston/kooshan_main?urlpath=tree/jupyter_book/notebooks/complete_notebook.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/npr99/IN-CORE_Galveston/blob/kooshan_main/jupyter_book/notebooks/complete_notebook.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/npr99/IN-CORE_Galveston" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/npr99/IN-CORE_Galveston/issues/new?title=Issue%20on%20page%20%2Fnotebooks/complete_notebook.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notebooks/complete_notebook.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Example: Galveston Testbed</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prerequisites">1. Prerequisites</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#load-packages">1.1 Load packages</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#define-hazard">1.2 Define hazard</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#define-inventory">1.3 Define inventory</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#buildings">1.3.1 Buildings</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#power-infrastructure">1.3.2 Power infrastructure</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#transportation-infrastructure">1.3.3 Transportation infrastructure</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#paper-figure">1.3.4 Paper figure</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#combined-building-damage">2. Combined building damage</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#wind-building-damage">2.1 Wind building damage</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#surge-wave-building-damage">2.2 Surge-Wave building damage</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inundation-flood-building-damage">2.3 Inundation (flood) building damage</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#combine-wind-surge-wave-and-flood-building-damage">2.4 Combine wind, surge-wave and flood building damage</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#hazard-exposure-example-surge-wave">2.4.1 Hazard exposure example: surge-wave</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#combined-damage-setup">2.4.2 Combined damage: setup</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#hazard-exposure-example-combined">2.4.3 Hazard exposure example: combined</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#archetype-mapping">2.5 Archetype mapping</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-results">2.6 Plot results</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">2.6.1 Combined building damage</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">2.6.2 Paper figure</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#electric-power-pole-damage">3. Electric Power Pole Damage</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#monte-carlo-sampling">4. Monte Carlo sampling</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">4.1 Buildings</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#electric-power-poles">4.2 Electric power poles</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#building-functionality">5. Building functionality</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#capital-shocks">6. Capital Shocks</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#population-dislocation-multihazard-comparison">7. Population dislocation - Multihazard Comparison</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setup-general-population-data">7.1 Setup general population data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#initial-loop-for-dislocation">7.2 Initial loop for dislocation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#clean-and-merge-dislocation-data">7.3 Clean and merge dislocation data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#merge-in-infrastructure-analyses-on-transportation-and-power">7.4 Merge in infrastructure analyses on transportation and power</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#add-flag-for-power-outage-and-road-closure">7.5 Add Flag for Power Outage and Road Closure</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#modify-dislocation-for-hhsr">7.6 Modify dislocation for HHSR</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#housing-household-recovery-sequentials">8. Housing Household Recovery Sequentials</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#social-vulnerabilities">8.1 Social vulnerabilities</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#run-simulation">8.2 Run simulation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#results-multi-hazard">8.3 Results: multi-hazard</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#results-infrastructure">8.3 Results: infrastructure</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="example-galveston-testbed">
<h1>Example: Galveston Testbed<a class="headerlink" href="#example-galveston-testbed" title="Permalink to this heading">#</a></h1>
<p>Reference paper: <a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S2772741623000388">Multi-hazard socio-physical resilience assessment of hurricane-induced hazards on coastal communities</a></p>
<p>Reference notebook: <a class="reference external" href="https://github.com/npr99/IN-CORE_Galveston/blob/kooshan_main/jupyter_book/notebooks/complete_notebook.ipynb">Latest Galveston Jupyter Notebook</a></p>
<section id="prerequisites">
<h2>1. Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this heading">#</a></h2>
<section id="load-packages">
<h3>1.1 Load packages<a class="headerlink" href="#load-packages" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">contextily</span> <span class="k">as</span> <span class="nn">ctx</span>

<span class="kn">from</span> <span class="nn">pyincore</span> <span class="kn">import</span> <span class="n">IncoreClient</span><span class="p">,</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">DataService</span><span class="p">,</span> <span class="n">HazardService</span><span class="p">,</span> <span class="n">FragilityService</span><span class="p">,</span> <span class="n">MappingSet</span><span class="p">,</span> <span class="n">FragilityCurveSet</span>
<span class="kn">from</span> <span class="nn">pyincore</span> <span class="kn">import</span> <span class="n">HHRSOutputProcess</span>
<span class="kn">from</span> <span class="nn">pyincore.utils.dataprocessutil</span> <span class="kn">import</span> <span class="n">DataProcessUtil</span>

<span class="c1"># importing pyIncone analyses:</span>
<span class="kn">from</span> <span class="nn">pyincore.analyses.buildingdamage</span> <span class="kn">import</span> <span class="n">BuildingDamage</span>
<span class="kn">from</span> <span class="nn">pyincore.analyses.buildingfunctionality</span> <span class="kn">import</span> <span class="n">BuildingFunctionality</span>
<span class="kn">from</span> <span class="nn">pyincore.analyses.combinedwindwavesurgebuildingdamage</span> <span class="kn">import</span> <span class="n">CombinedWindWaveSurgeBuildingDamage</span>
<span class="kn">from</span> <span class="nn">pyincore.analyses.epfdamage</span> <span class="kn">import</span> <span class="n">EpfDamage</span>
<span class="kn">from</span> <span class="nn">pyincore.analyses.montecarlofailureprobability</span> <span class="kn">import</span> <span class="n">MonteCarloFailureProbability</span>
<span class="kn">from</span> <span class="nn">pyincore.analyses.housingunitallocation</span> <span class="kn">import</span> <span class="n">HousingUnitAllocation</span>
<span class="kn">from</span> <span class="nn">pyincore.analyses.populationdislocation</span> <span class="kn">import</span> <span class="n">PopulationDislocation</span><span class="p">,</span> <span class="n">PopulationDislocationUtil</span>
<span class="kn">from</span> <span class="nn">pyincore.analyses.housingrecoverysequential</span> <span class="kn">import</span> <span class="n">HousingRecoverySequential</span>
<span class="kn">from</span> <span class="nn">pyincore.analyses.socialvulnerability</span> <span class="kn">import</span> <span class="n">SocialVulnerability</span>
<span class="kn">from</span> <span class="nn">pyincore.analyses.capitalshocks</span> <span class="kn">import</span> <span class="n">CapitalShocks</span>

<span class="c1"># Functions for visualizing the population data results as tables</span>
<span class="kn">from</span> <span class="nn">pyincore_viz.analysis.popresultstable</span> <span class="kn">import</span> <span class="n">PopResultsTable</span> <span class="k">as</span> <span class="n">poptable</span>
<span class="kn">from</span> <span class="nn">pyincore_viz.geoutil</span> <span class="kn">import</span> <span class="n">GeoUtil</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">3</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="kn">import</span> <span class="nn">warnings</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;pandas&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">client</span> <span class="o">=</span> <span class="n">IncoreClient</span><span class="p">()</span>
<span class="c1"># IN-CORE caches files on the local machine, it might be necessary to clear the memory</span>
<span class="c1"># client.clear_cache() </span>
<span class="n">data_service</span> <span class="o">=</span> <span class="n">DataService</span><span class="p">(</span><span class="n">client</span><span class="p">)</span> <span class="c1"># create data_service object for loading files</span>
<span class="n">hazard_service</span> <span class="o">=</span> <span class="n">HazardService</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">fragility_services</span> <span class="o">=</span> <span class="n">FragilityService</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Connection successful to IN-CORE services. pyIncore version detected: 1.13.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">client</span><span class="o">.</span><span class="n">clear_cache</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="define-hazard">
<h3>1.2 Define hazard<a class="headerlink" href="#define-hazard" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hazard_type</span> <span class="o">=</span> <span class="s2">&quot;hurricane&quot;</span>

<span class="c1"># 100yr Hazard Event</span>
<span class="n">hazard_id</span> <span class="o">=</span> <span class="s2">&quot;5fa5a9497e5cdf51ebf1add2&quot;</span>

<span class="c1"># 500yr Hazard Event</span>
<span class="c1">#hazard_id = &quot;5fa5aa19b6429615aeea4476&quot;</span>

<span class="c1"># Galveston Hurricane Ike</span>
<span class="c1"># hazard_id = &quot;5fa5a228b6429615aeea4410&quot;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="define-inventory">
<h3>1.3 Define inventory<a class="headerlink" href="#define-inventory" title="Permalink to this heading">#</a></h3>
<section id="buildings">
<h4>1.3.1 Buildings<a class="headerlink" href="#buildings" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Galveston inventory data</span>
<span class="c1"># bldg_dataset_id = &quot;63053ddaf5438e1f8c517fed&quot; # Full city</span>
<span class="n">bldg_dataset_id</span> <span class="o">=</span> <span class="s2">&quot;63ff6b135c35c0353d5ed3ac&quot;</span> <span class="c1"># Island Only</span>
<span class="n">bldg_dataset_id</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;63ff6b135c35c0353d5ed3ac&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="power-infrastructure">
<h4>1.3.2 Power infrastructure<a class="headerlink" href="#power-infrastructure" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load shapefile</span>
<span class="n">shp_power</span> <span class="o">=</span> <span class="s1">&#39;./data/power_network/power_network.shp&#39;</span>
<span class="c1"># Load the shapefile</span>
<span class="n">gdf_power</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">shp_power</span><span class="p">)</span>
<span class="c1"># plot and show</span>
<span class="n">gdf_power</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ca12fc044aef32aa8074198ddcee6e37f6f858e860ee38249812e56edf97d39d.png" src="../_images/ca12fc044aef32aa8074198ddcee6e37f6f858e860ee38249812e56edf97d39d.png" />
</div>
</div>
</section>
<section id="transportation-infrastructure">
<h4>1.3.3 Transportation infrastructure<a class="headerlink" href="#transportation-infrastructure" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load shapefile</span>
<span class="n">shp_transportation</span> <span class="o">=</span> <span class="s1">&#39;./data/transportation_network/transportation_network.shp&#39;</span>
<span class="c1"># Load the shapefile</span>
<span class="n">gdf_transportation</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">shp_transportation</span><span class="p">)</span>
<span class="c1"># plot and show</span>
<span class="n">gdf_transportation</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/15fa2ecd2e65e859d52e0911e1ff2bbd385f6fe08a092d116a1e85abc3612f3e.png" src="../_images/15fa2ecd2e65e859d52e0911e1ff2bbd385f6fe08a092d116a1e85abc3612f3e.png" />
</div>
</div>
</section>
<section id="paper-figure">
<h4>1.3.4 Paper figure<a class="headerlink" href="#paper-figure" title="Permalink to this heading">#</a></h4>
<img src="https://ars.els-cdn.com/content/image/1-s2.0-S2772741623000388-gr3_lrg.jpg" width="700"/></section>
</section>
</section>
<section id="combined-building-damage">
<h2>2. Combined building damage<a class="headerlink" href="#combined-building-damage" title="Permalink to this heading">#</a></h2>
<section id="wind-building-damage">
<h3>2.1 Wind building damage<a class="headerlink" href="#wind-building-damage" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Building Wind Fragility mapping</span>
<span class="n">mapping_id</span> <span class="o">=</span> <span class="s2">&quot;62fef3a6cef2881193f2261d&quot;</span>
<span class="n">fragility_service</span> <span class="o">=</span> <span class="n">FragilityService</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">mapping_set</span> <span class="o">=</span> <span class="n">MappingSet</span><span class="p">(</span><span class="n">fragility_service</span><span class="o">.</span><span class="n">get_mapping</span><span class="p">(</span><span class="n">mapping_id</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># wind building damage</span>
<span class="n">w_bldg_dmg</span> <span class="o">=</span> <span class="n">BuildingDamage</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">w_bldg_dmg</span><span class="o">.</span><span class="n">load_remote_input_dataset</span><span class="p">(</span><span class="s2">&quot;buildings&quot;</span><span class="p">,</span> <span class="n">bldg_dataset_id</span><span class="p">)</span>
<span class="n">w_bldg_dmg</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s1">&#39;dfr3_mapping_set&#39;</span><span class="p">,</span> <span class="n">mapping_set</span><span class="p">)</span>
<span class="n">w_bldg_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;result_name&quot;</span><span class="p">,</span> <span class="s2">&quot;Galveston-wind-dmg&quot;</span><span class="p">)</span>
<span class="n">w_bldg_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;hazard_type&quot;</span><span class="p">,</span> <span class="n">hazard_type</span><span class="p">)</span>
<span class="n">w_bldg_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;hazard_id&quot;</span><span class="p">,</span> <span class="n">hazard_id</span><span class="p">)</span>
<span class="n">w_bldg_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;num_cpu&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">w_bldg_dmg</span><span class="o">.</span><span class="n">run_analysis</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
</section>
<section id="surge-wave-building-damage">
<h3>2.2 Surge-Wave building damage<a class="headerlink" href="#surge-wave-building-damage" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Surge-wave mapping</span>
<span class="n">mapping_id</span> <span class="o">=</span> <span class="s2">&quot;6303e51bd76c6d0e1f6be080&quot;</span>
<span class="n">mapping_set</span> <span class="o">=</span> <span class="n">MappingSet</span><span class="p">(</span><span class="n">fragility_service</span><span class="o">.</span><span class="n">get_mapping</span><span class="p">(</span><span class="n">mapping_id</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># surge-wave building damage</span>
<span class="n">sw_bldg_dmg</span> <span class="o">=</span> <span class="n">BuildingDamage</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">sw_bldg_dmg</span><span class="o">.</span><span class="n">load_remote_input_dataset</span><span class="p">(</span><span class="s2">&quot;buildings&quot;</span><span class="p">,</span> <span class="n">bldg_dataset_id</span><span class="p">)</span>
<span class="n">sw_bldg_dmg</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s1">&#39;dfr3_mapping_set&#39;</span><span class="p">,</span> <span class="n">mapping_set</span><span class="p">)</span>
<span class="n">sw_bldg_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;result_name&quot;</span><span class="p">,</span> <span class="s2">&quot;Galveston-sw-dmg&quot;</span><span class="p">)</span>
<span class="n">sw_bldg_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;hazard_type&quot;</span><span class="p">,</span> <span class="n">hazard_type</span><span class="p">)</span>
<span class="n">sw_bldg_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;hazard_id&quot;</span><span class="p">,</span> <span class="n">hazard_id</span><span class="p">)</span>
<span class="n">sw_bldg_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;num_cpu&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">sw_bldg_dmg</span><span class="o">.</span><span class="n">run_analysis</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
</section>
<section id="inundation-flood-building-damage">
<h3>2.3 Inundation (flood) building damage<a class="headerlink" href="#inundation-flood-building-damage" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># flood mapping</span>
<span class="n">mapping_id</span> <span class="o">=</span> <span class="s2">&quot;62fefd688a30d30dac57bbd7&quot;</span>
<span class="n">mapping_set</span> <span class="o">=</span> <span class="n">MappingSet</span><span class="p">(</span><span class="n">fragility_service</span><span class="o">.</span><span class="n">get_mapping</span><span class="p">(</span><span class="n">mapping_id</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># flood building damage</span>
<span class="n">f_bldg_dmg</span> <span class="o">=</span> <span class="n">BuildingDamage</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">f_bldg_dmg</span><span class="o">.</span><span class="n">load_remote_input_dataset</span><span class="p">(</span><span class="s2">&quot;buildings&quot;</span><span class="p">,</span> <span class="n">bldg_dataset_id</span><span class="p">)</span>
<span class="n">f_bldg_dmg</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s1">&#39;dfr3_mapping_set&#39;</span><span class="p">,</span> <span class="n">mapping_set</span><span class="p">)</span>
<span class="n">f_bldg_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;result_name&quot;</span><span class="p">,</span> <span class="s2">&quot;Galveston-flood-dmg&quot;</span><span class="p">)</span>
<span class="n">f_bldg_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;hazard_type&quot;</span><span class="p">,</span> <span class="n">hazard_type</span><span class="p">)</span>
<span class="n">f_bldg_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;hazard_id&quot;</span><span class="p">,</span> <span class="n">hazard_id</span><span class="p">)</span>
<span class="n">f_bldg_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;num_cpu&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">f_bldg_dmg</span><span class="o">.</span><span class="n">run_analysis</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
</section>
<section id="combine-wind-surge-wave-and-flood-building-damage">
<h3>2.4 Combine wind, surge-wave and flood building damage<a class="headerlink" href="#combine-wind-surge-wave-and-flood-building-damage" title="Permalink to this heading">#</a></h3>
<section id="hazard-exposure-example-surge-wave">
<h4>2.4.1 Hazard exposure example: surge-wave<a class="headerlink" href="#hazard-exposure-example-surge-wave" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">surge_wave_damage</span> <span class="o">=</span> <span class="n">sw_bldg_dmg</span><span class="o">.</span><span class="n">get_output_dataset</span><span class="p">(</span><span class="s2">&quot;ds_result&quot;</span><span class="p">)</span>
<span class="n">wind_damage</span> <span class="o">=</span> <span class="n">w_bldg_dmg</span><span class="o">.</span><span class="n">get_output_dataset</span><span class="p">(</span><span class="s2">&quot;ds_result&quot;</span><span class="p">)</span>
<span class="n">flood_damage</span> <span class="o">=</span> <span class="n">f_bldg_dmg</span><span class="o">.</span><span class="n">get_output_dataset</span><span class="p">(</span><span class="s2">&quot;ds_result&quot;</span><span class="p">)</span>
<span class="c1">#surge_wave_damage.get_dataframe_from_csv(low_memory=False)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">surge_wave_damage</span><span class="o">.</span><span class="n">get_dataframe_from_csv</span><span class="p">(</span><span class="n">low_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">yes_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;haz_expose&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">])</span>
<span class="n">partial_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;haz_expose&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;partial&#39;</span><span class="p">])</span>
<span class="n">sum_count</span> <span class="o">=</span> <span class="n">yes_count</span> <span class="o">+</span> <span class="n">partial_count</span>
<span class="n">total_rows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Count of &quot;yes&quot;:&#39;</span><span class="p">,</span> <span class="n">yes_count</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Count of &quot;partial&quot;:&#39;</span><span class="p">,</span> <span class="n">partial_count</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Sum of &quot;yes&quot; and &quot;partial&quot;:&#39;</span><span class="p">,</span> <span class="n">sum_count</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total number of rows:&#39;</span><span class="p">,</span> <span class="n">total_rows</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Count of &quot;yes&quot;: 26278
Count of &quot;partial&quot;: 744
Sum of &quot;yes&quot; and &quot;partial&quot;: 27022
Total number of rows: 29541
</pre></div>
</div>
</div>
</div>
</section>
<section id="combined-damage-setup">
<h4>2.4.2 Combined damage: setup<a class="headerlink" href="#combined-damage-setup" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">combined_bldg_dmg</span> <span class="o">=</span> <span class="n">CombinedWindWaveSurgeBuildingDamage</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">result_name</span> <span class="o">=</span> <span class="s2">&quot;Galveston-combined-dmg&quot;</span>
<span class="n">combined_bldg_dmg</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s2">&quot;surge_wave_damage&quot;</span><span class="p">,</span> <span class="n">surge_wave_damage</span><span class="p">)</span>
<span class="n">combined_bldg_dmg</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s2">&quot;wind_damage&quot;</span><span class="p">,</span> <span class="n">wind_damage</span><span class="p">)</span>
<span class="n">combined_bldg_dmg</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s2">&quot;flood_damage&quot;</span><span class="p">,</span> <span class="n">flood_damage</span><span class="p">)</span>
<span class="n">combined_bldg_dmg</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;result_name&quot;</span><span class="p">,</span> <span class="n">result_name</span><span class="p">)</span>
<span class="n">combined_bldg_dmg</span><span class="o">.</span><span class="n">run_analysis</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
</section>
<section id="hazard-exposure-example-combined">
<h4>2.4.3 Hazard exposure example: combined<a class="headerlink" href="#hazard-exposure-example-combined" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">combined_dmg</span> <span class="o">=</span> <span class="n">combined_bldg_dmg</span><span class="o">.</span><span class="n">get_output_dataset</span><span class="p">(</span><span class="s2">&quot;ds_result&quot;</span><span class="p">)</span>
<span class="n">combined_dmg_df</span> <span class="o">=</span> <span class="n">combined_dmg</span><span class="o">.</span><span class="n">get_dataframe_from_csv</span><span class="p">(</span><span class="n">low_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Display top 5 rows of output data</span>
<span class="n">combined_dmg_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="n">combined_dmg_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;combined_dmg_df.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">combined_dmg_df</span>
<span class="n">yes_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;haz_expose&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">])</span>
<span class="n">partial_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;haz_expose&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;partial&#39;</span><span class="p">])</span>
<span class="n">sum_count</span> <span class="o">=</span> <span class="n">yes_count</span> <span class="o">+</span> <span class="n">partial_count</span>
<span class="n">total_rows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Count of &quot;yes&quot;:&#39;</span><span class="p">,</span> <span class="n">yes_count</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Count of &quot;partial&quot;:&#39;</span><span class="p">,</span> <span class="n">partial_count</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Sum of &quot;yes&quot; and &quot;partial&quot;:&#39;</span><span class="p">,</span> <span class="n">sum_count</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total number of rows:&#39;</span><span class="p">,</span> <span class="n">total_rows</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Count of &quot;yes&quot;: 29526
Count of &quot;partial&quot;: 11
Sum of &quot;yes&quot; and &quot;partial&quot;: 29537
Total number of rows: 29541
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="archetype-mapping">
<h3>2.5 Archetype mapping<a class="headerlink" href="#archetype-mapping" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">buildings</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_data_service</span><span class="p">(</span><span class="n">bldg_dataset_id</span><span class="p">,</span> <span class="n">data_service</span><span class="p">)</span>
<span class="n">bldg_gdf</span> <span class="o">=</span> <span class="n">buildings</span><span class="o">.</span><span class="n">get_dataframe_from_shapefile</span><span class="p">()</span>
<span class="n">bldg_gdf</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>strctid</th>
      <th>parid</th>
      <th>struct_typ</th>
      <th>year_built</th>
      <th>no_stories</th>
      <th>a_stories</th>
      <th>b_stories</th>
      <th>bsmt_type</th>
      <th>sq_foot</th>
      <th>gsq_foot</th>
      <th>...</th>
      <th>ffe_elev</th>
      <th>g_elev</th>
      <th>archetype</th>
      <th>arch_wind</th>
      <th>arch_flood</th>
      <th>arch_sw</th>
      <th>csv_guid</th>
      <th>csv_sector</th>
      <th>csv_val_st</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>STf3a21b5f-0334-4d77-911f-faa9a45c92d7</td>
      <td>0</td>
      <td>NaN</td>
      <td>1980</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>47927</td>
      <td>0</td>
      <td>...</td>
      <td>3.76991</td>
      <td>3.46511</td>
      <td>0</td>
      <td>15</td>
      <td>6</td>
      <td>15</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>POINT (-94.81680 29.31409)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>ST80ab0289-8c72-4699-b12b-08ef2f2a5c91</td>
      <td>0</td>
      <td>NaN</td>
      <td>1954</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>100796</td>
      <td>0</td>
      <td>...</td>
      <td>2.26048</td>
      <td>1.95568</td>
      <td>0</td>
      <td>15</td>
      <td>6</td>
      <td>15</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>POINT (-94.82295 29.29635)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ST7916eaa8-0bfa-4b32-84ff-20f19a520f5c</td>
      <td>0</td>
      <td>NaN</td>
      <td>1970</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>27121</td>
      <td>0</td>
      <td>...</td>
      <td>2.68011</td>
      <td>2.37531</td>
      <td>0</td>
      <td>15</td>
      <td>6</td>
      <td>15</td>
      <td>7916eaa8-0bfa-4b32-84ff-20f19a520f5c</td>
      <td>IRetail</td>
      <td>2435054.5</td>
      <td>POINT (-94.82423 29.29098)</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ST79008971-a534-4e45-9e40-43a2a904e59b</td>
      <td>0</td>
      <td>NaN</td>
      <td>2002</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>126333</td>
      <td>0</td>
      <td>...</td>
      <td>2.91465</td>
      <td>2.60985</td>
      <td>0</td>
      <td>15</td>
      <td>6</td>
      <td>15</td>
      <td>79008971-a534-4e45-9e40-43a2a904e59b</td>
      <td>IProfSer</td>
      <td>4483599</td>
      <td>POINT (-94.84045 29.29117)</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ST2ad8ab6f-057f-468e-9911-6e92d9d4d01f</td>
      <td>0</td>
      <td>NaN</td>
      <td>2002</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>114544</td>
      <td>0</td>
      <td>...</td>
      <td>3.73770</td>
      <td>3.43290</td>
      <td>0</td>
      <td>15</td>
      <td>6</td>
      <td>15</td>
      <td>2ad8ab6f-057f-468e-9911-6e92d9d4d01f</td>
      <td>IRealE</td>
      <td>282702.06</td>
      <td>POINT (-94.84242 29.29059)</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 38 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">arch_mapping</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_data_service</span><span class="p">(</span><span class="s2">&quot;63dc1f1362b9d001e6a1b485&quot;</span><span class="p">,</span> <span class="n">data_service</span><span class="p">)</span><span class="o">.</span><span class="n">get_dataframe_from_csv</span><span class="p">()</span>
<span class="n">arch_mapping</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>arch_wind</th>
      <th>category</th>
      <th>cluster</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>12.0</td>
      <td>Critical Facilities</td>
      <td>Critical Medical - Acute Care Hospitals</td>
    </tr>
    <tr>
      <th>1</th>
      <td>14.0</td>
      <td>Critical Facilities</td>
      <td>Emergency Operations Centers</td>
    </tr>
    <tr>
      <th>2</th>
      <td>11.0</td>
      <td>Critical Facilities</td>
      <td>Critical Government - First Responder Facilities</td>
    </tr>
    <tr>
      <th>3</th>
      <td>NaN</td>
      <td>Critical Facilities</td>
      <td>Non-ambulatory Facilities - Prisons, nursing h...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>NaN</td>
      <td>Emergency Housing</td>
      <td>Emergency Shelters</td>
    </tr>
    <tr>
      <th>5</th>
      <td>NaN</td>
      <td>Emergency Housing</td>
      <td>Residential Housing</td>
    </tr>
    <tr>
      <th>6</th>
      <td>NaN</td>
      <td>Emergency Housing</td>
      <td>SFH and Multi-family</td>
    </tr>
    <tr>
      <th>7</th>
      <td>NaN</td>
      <td>Housing / Neighborhood</td>
      <td>Critical Retail</td>
    </tr>
    <tr>
      <th>8</th>
      <td>13.0</td>
      <td>Housing / Neighborhood</td>
      <td>Religious and Spiritual Centers</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1.0</td>
      <td>Housing / Neighborhood</td>
      <td>Residential Housing</td>
    </tr>
    <tr>
      <th>10</th>
      <td>2.0</td>
      <td>Housing / Neighborhood</td>
      <td>Residential Housing</td>
    </tr>
    <tr>
      <th>11</th>
      <td>3.0</td>
      <td>Housing / Neighborhood</td>
      <td>Residential Housing</td>
    </tr>
    <tr>
      <th>12</th>
      <td>4.0</td>
      <td>Housing / Neighborhood</td>
      <td>Residential Housing</td>
    </tr>
    <tr>
      <th>13</th>
      <td>5.0</td>
      <td>Housing / Neighborhood</td>
      <td>Residential Housing</td>
    </tr>
    <tr>
      <th>14</th>
      <td>17.0</td>
      <td>Housing / Neighborhood</td>
      <td>Residential Housing</td>
    </tr>
    <tr>
      <th>15</th>
      <td>NaN</td>
      <td>Housing / Neighborhood</td>
      <td>SFH and Multi-family</td>
    </tr>
    <tr>
      <th>16</th>
      <td>9.0</td>
      <td>Housing / Neighborhood</td>
      <td>K-12 Schools</td>
    </tr>
    <tr>
      <th>17</th>
      <td>10.0</td>
      <td>Housing / Neighborhood</td>
      <td>K-12 Schools</td>
    </tr>
    <tr>
      <th>18</th>
      <td>NaN</td>
      <td>Housing / Neighborhood</td>
      <td>Child Care Centers</td>
    </tr>
    <tr>
      <th>19</th>
      <td>NaN</td>
      <td>Housing / Neighborhood</td>
      <td>Hotels and Motels</td>
    </tr>
    <tr>
      <th>20</th>
      <td>7.0</td>
      <td>Community Recovery</td>
      <td>Business - Manufacturing</td>
    </tr>
    <tr>
      <th>21</th>
      <td>8.0</td>
      <td>Community Recovery</td>
      <td>Business - Manufacturing</td>
    </tr>
    <tr>
      <th>22</th>
      <td>6.0</td>
      <td>Community Recovery</td>
      <td>Business - Commodity Services</td>
    </tr>
    <tr>
      <th>23</th>
      <td>15.0</td>
      <td>Community Recovery</td>
      <td>Business - Commodity Services</td>
    </tr>
    <tr>
      <th>24</th>
      <td>16.0</td>
      <td>Community Recovery</td>
      <td>Business - Commodity Services</td>
    </tr>
    <tr>
      <th>25</th>
      <td>18.0</td>
      <td>Community Recovery</td>
      <td>Business - Commodity Services</td>
    </tr>
    <tr>
      <th>26</th>
      <td>19.0</td>
      <td>Community Recovery</td>
      <td>Business - Service Professions</td>
    </tr>
    <tr>
      <th>27</th>
      <td>NaN</td>
      <td>Community Recovery</td>
      <td>Conference &amp; Event Venues</td>
    </tr>
    <tr>
      <th>28</th>
      <td>NaN</td>
      <td>Community Recovery</td>
      <td>Other</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">max_dmg_state_df</span> <span class="o">=</span> <span class="n">DataProcessUtil</span><span class="o">.</span><span class="n">get_max_damage_state</span><span class="p">(</span><span class="n">combined_dmg_df</span><span class="p">)</span>
<span class="n">max_dmg_state_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>guid</th>
      <th>max_prob</th>
      <th>max_state</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>f3a21b5f-0334-4d77-911f-faa9a45c92d7</td>
      <td>0.656011</td>
      <td>DS_0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>80ab0289-8c72-4699-b12b-08ef2f2a5c91</td>
      <td>0.711510</td>
      <td>DS_2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>7916eaa8-0bfa-4b32-84ff-20f19a520f5c</td>
      <td>0.896200</td>
      <td>DS_0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>79008971-a534-4e45-9e40-43a2a904e59b</td>
      <td>0.695918</td>
      <td>DS_0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2ad8ab6f-057f-468e-9911-6e92d9d4d01f</td>
      <td>0.575940</td>
      <td>DS_0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>29536</th>
      <td>1ac5be10-582c-46b2-91ed-469f684bb886</td>
      <td>0.999993</td>
      <td>DS_3</td>
    </tr>
    <tr>
      <th>29537</th>
      <td>fbcfb6d6-de13-42fa-9839-d7c80afc651d</td>
      <td>0.357067</td>
      <td>DS_2</td>
    </tr>
    <tr>
      <th>29538</th>
      <td>2ee961c9-cd94-499e-b1fe-3e0220a440ea</td>
      <td>0.545299</td>
      <td>DS_2</td>
    </tr>
    <tr>
      <th>29539</th>
      <td>fa15cfbc-8a60-4a3f-b40f-7a6fada625b9</td>
      <td>0.678298</td>
      <td>DS_0</td>
    </tr>
    <tr>
      <th>29540</th>
      <td>3a8a9360-48b1-4399-950d-d32969b0a381</td>
      <td>0.678298</td>
      <td>DS_0</td>
    </tr>
  </tbody>
</table>
<p>29541 rows × 3 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ret_json</span> <span class="o">=</span> <span class="n">DataProcessUtil</span><span class="o">.</span><span class="n">create_mapped_dmg_result</span><span class="p">(</span><span class="n">bldg_gdf</span><span class="p">,</span> <span class="n">max_dmg_state_df</span><span class="p">,</span> <span class="n">arch_mapping</span><span class="p">,</span> <span class="s2">&quot;max_state&quot;</span><span class="p">,</span> <span class="s2">&quot;arch_wind&quot;</span><span class="p">)</span>
<span class="n">ret_json</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;by_cluster&#39;: [{&#39;category&#39;: &#39;Critical Facilities&#39;,
   &#39;cluster&#39;: &#39;Critical Medical - Acute Care Hospitals&#39;,
   &#39;DS_0&#39;: 10,
   &#39;DS_1&#39;: 5,
   &#39;DS_2&#39;: 0,
   &#39;DS_3&#39;: 0},
  {&#39;category&#39;: &#39;Critical Facilities&#39;,
   &#39;cluster&#39;: &#39;Emergency Operations Centers&#39;,
   &#39;DS_0&#39;: -1,
   &#39;DS_1&#39;: -1,
   &#39;DS_2&#39;: -1,
   &#39;DS_3&#39;: -1},
  {&#39;category&#39;: &#39;Critical Facilities&#39;,
   &#39;cluster&#39;: &#39;Critical Government - First Responder Facilities&#39;,
   &#39;DS_0&#39;: -1,
   &#39;DS_1&#39;: -1,
   &#39;DS_2&#39;: -1,
   &#39;DS_3&#39;: -1},
  {&#39;category&#39;: &#39;Critical Facilities&#39;,
   &#39;cluster&#39;: &#39;Non-ambulatory Facilities - Prisons, nursing homes, etc.&#39;,
   &#39;DS_0&#39;: -1,
   &#39;DS_1&#39;: -1,
   &#39;DS_2&#39;: -1,
   &#39;DS_3&#39;: -1},
  {&#39;category&#39;: &#39;Emergency Housing &#39;,
   &#39;cluster&#39;: &#39;Emergency Shelters&#39;,
   &#39;DS_0&#39;: -1,
   &#39;DS_1&#39;: -1,
   &#39;DS_2&#39;: -1,
   &#39;DS_3&#39;: -1},
  {&#39;category&#39;: &#39;Emergency Housing &#39;,
   &#39;cluster&#39;: &#39;Residential Housing&#39;,
   &#39;DS_0&#39;: -1,
   &#39;DS_1&#39;: -1,
   &#39;DS_2&#39;: -1,
   &#39;DS_3&#39;: -1},
  {&#39;category&#39;: &#39;Emergency Housing &#39;,
   &#39;cluster&#39;: &#39;SFH and Multi-family&#39;,
   &#39;DS_0&#39;: -1,
   &#39;DS_1&#39;: -1,
   &#39;DS_2&#39;: -1,
   &#39;DS_3&#39;: -1},
  {&#39;category&#39;: &#39;Housing / Neighborhood&#39;,
   &#39;cluster&#39;: &#39;Critical Retail&#39;,
   &#39;DS_0&#39;: -1,
   &#39;DS_1&#39;: -1,
   &#39;DS_2&#39;: -1,
   &#39;DS_3&#39;: -1},
  {&#39;category&#39;: &#39;Housing / Neighborhood&#39;,
   &#39;cluster&#39;: &#39;Religious and Spiritual Centers&#39;,
   &#39;DS_0&#39;: -1,
   &#39;DS_1&#39;: -1,
   &#39;DS_2&#39;: -1,
   &#39;DS_3&#39;: -1},
  {&#39;category&#39;: &#39;Housing / Neighborhood&#39;,
   &#39;cluster&#39;: &#39;Residential Housing&#39;,
   &#39;DS_0&#39;: 4950,
   &#39;DS_1&#39;: 1731,
   &#39;DS_2&#39;: 17259,
   &#39;DS_3&#39;: 2943},
  {&#39;category&#39;: &#39;Housing / Neighborhood&#39;,
   &#39;cluster&#39;: &#39;SFH and Multi-family&#39;,
   &#39;DS_0&#39;: -1,
   &#39;DS_1&#39;: -1,
   &#39;DS_2&#39;: -1,
   &#39;DS_3&#39;: -1},
  {&#39;category&#39;: &#39;Housing / Neighborhood&#39;,
   &#39;cluster&#39;: &#39;K-12 Schools&#39;,
   &#39;DS_0&#39;: 10,
   &#39;DS_1&#39;: 0,
   &#39;DS_2&#39;: 2,
   &#39;DS_3&#39;: 0},
  {&#39;category&#39;: &#39;Housing / Neighborhood&#39;,
   &#39;cluster&#39;: &#39;Child Care Centers&#39;,
   &#39;DS_0&#39;: -1,
   &#39;DS_1&#39;: -1,
   &#39;DS_2&#39;: -1,
   &#39;DS_3&#39;: -1},
  {&#39;category&#39;: &#39;Housing / Neighborhood&#39;,
   &#39;cluster&#39;: &#39;Hotels and Motels&#39;,
   &#39;DS_0&#39;: -1,
   &#39;DS_1&#39;: -1,
   &#39;DS_2&#39;: -1,
   &#39;DS_3&#39;: -1},
  {&#39;category&#39;: &#39;Community Recovery&#39;,
   &#39;cluster&#39;: &#39;Business - Manufacturing&#39;,
   &#39;DS_0&#39;: 48,
   &#39;DS_1&#39;: 18,
   &#39;DS_2&#39;: 5,
   &#39;DS_3&#39;: 17},
  {&#39;category&#39;: &#39;Community Recovery&#39;,
   &#39;cluster&#39;: &#39;Business - Commodity Services&#39;,
   &#39;DS_0&#39;: 646,
   &#39;DS_1&#39;: 709,
   &#39;DS_2&#39;: 1019,
   &#39;DS_3&#39;: 27},
  {&#39;category&#39;: &#39;Community Recovery&#39;,
   &#39;cluster&#39;: &#39;Business - Service Professions&#39;,
   &#39;DS_0&#39;: 31,
   &#39;DS_1&#39;: 1,
   &#39;DS_2&#39;: 110,
   &#39;DS_3&#39;: 0},
  {&#39;category&#39;: &#39;Community Recovery&#39;,
   &#39;cluster&#39;: &#39;Conference &amp; Event Venues&#39;,
   &#39;DS_0&#39;: -1,
   &#39;DS_1&#39;: -1,
   &#39;DS_2&#39;: -1,
   &#39;DS_3&#39;: -1},
  {&#39;category&#39;: &#39;Community Recovery&#39;,
   &#39;cluster&#39;: &#39;Other&#39;,
   &#39;DS_0&#39;: -1,
   &#39;DS_1&#39;: -1,
   &#39;DS_2&#39;: -1,
   &#39;DS_3&#39;: -1}],
 &#39;by_category&#39;: [{&#39;category&#39;: &#39;Critical Facilities&#39;,
   &#39;DS_0&#39;: 10,
   &#39;DS_1&#39;: 5,
   &#39;DS_2&#39;: 0,
   &#39;DS_3&#39;: 0},
  {&#39;category&#39;: &#39;Emergency Housing &#39;,
   &#39;DS_0&#39;: -1,
   &#39;DS_1&#39;: -1,
   &#39;DS_2&#39;: -1,
   &#39;DS_3&#39;: -1},
  {&#39;category&#39;: &#39;Housing / Neighborhood&#39;,
   &#39;DS_0&#39;: 4960,
   &#39;DS_1&#39;: 1731,
   &#39;DS_2&#39;: 17261,
   &#39;DS_3&#39;: 2943},
  {&#39;category&#39;: &#39;Community Recovery&#39;,
   &#39;DS_0&#39;: 725,
   &#39;DS_1&#39;: 728,
   &#39;DS_2&#39;: 1134,
   &#39;DS_3&#39;: 44}]}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged_gdf</span> <span class="o">=</span> <span class="n">bldg_gdf</span><span class="p">[[</span><span class="s1">&#39;guid&#39;</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">max_dmg_state_df</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;guid&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;guid&#39;</span><span class="p">)</span>
<span class="n">merged_gdf</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>guid</th>
      <th>geometry</th>
      <th>max_prob</th>
      <th>max_state</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>f3a21b5f-0334-4d77-911f-faa9a45c92d7</td>
      <td>POINT (-94.81680 29.31409)</td>
      <td>0.656011</td>
      <td>DS_0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>80ab0289-8c72-4699-b12b-08ef2f2a5c91</td>
      <td>POINT (-94.82295 29.29635)</td>
      <td>0.711510</td>
      <td>DS_2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>7916eaa8-0bfa-4b32-84ff-20f19a520f5c</td>
      <td>POINT (-94.82423 29.29098)</td>
      <td>0.896200</td>
      <td>DS_0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>79008971-a534-4e45-9e40-43a2a904e59b</td>
      <td>POINT (-94.84045 29.29117)</td>
      <td>0.695918</td>
      <td>DS_0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2ad8ab6f-057f-468e-9911-6e92d9d4d01f</td>
      <td>POINT (-94.84242 29.29059)</td>
      <td>0.575940</td>
      <td>DS_0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>29536</th>
      <td>1ac5be10-582c-46b2-91ed-469f684bb886</td>
      <td>POINT (-94.78968 29.28593)</td>
      <td>0.999993</td>
      <td>DS_3</td>
    </tr>
    <tr>
      <th>29537</th>
      <td>fbcfb6d6-de13-42fa-9839-d7c80afc651d</td>
      <td>POINT (-94.79154 29.28914)</td>
      <td>0.357067</td>
      <td>DS_2</td>
    </tr>
    <tr>
      <th>29538</th>
      <td>2ee961c9-cd94-499e-b1fe-3e0220a440ea</td>
      <td>POINT (-94.78782 29.29591)</td>
      <td>0.545299</td>
      <td>DS_2</td>
    </tr>
    <tr>
      <th>29539</th>
      <td>fa15cfbc-8a60-4a3f-b40f-7a6fada625b9</td>
      <td>POINT (-94.79564 29.29522)</td>
      <td>0.678298</td>
      <td>DS_0</td>
    </tr>
    <tr>
      <th>29540</th>
      <td>3a8a9360-48b1-4399-950d-d32969b0a381</td>
      <td>POINT (-94.79652 29.29500)</td>
      <td>0.678298</td>
      <td>DS_0</td>
    </tr>
  </tbody>
</table>
<p>29541 rows × 4 columns</p>
</div></div></div>
</div>
</section>
<section id="plot-results">
<h3>2.6 Plot results<a class="headerlink" href="#plot-results" title="Permalink to this heading">#</a></h3>
<section id="id1">
<h4>2.6.1 Combined building damage<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Rename &#39;max_state&#39; values for the legend</span>
<span class="n">merged_gdf</span><span class="p">[</span><span class="s1">&#39;max_state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged_gdf</span><span class="p">[</span><span class="s1">&#39;max_state&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="s1">&#39;DS_0&#39;</span><span class="p">:</span> <span class="s1">&#39;Insignificant&#39;</span><span class="p">,</span>
                                                           <span class="s1">&#39;DS_1&#39;</span><span class="p">:</span> <span class="s1">&#39;Moderate&#39;</span><span class="p">,</span>
                                                           <span class="s1">&#39;DS_2&#39;</span><span class="p">:</span> <span class="s1">&#39;Extensive&#39;</span><span class="p">,</span>
                                                           <span class="s1">&#39;DS_3&#39;</span><span class="p">:</span> <span class="s1">&#39;Complete&#39;</span><span class="p">})</span>

<span class="c1"># Define colors for each &#39;max_state&#39;</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Insignificant&#39;</span><span class="p">:</span> <span class="s1">&#39;limegreen&#39;</span><span class="p">,</span> <span class="s1">&#39;Moderate&#39;</span><span class="p">:</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="s1">&#39;Extensive&#39;</span><span class="p">:</span> <span class="s1">&#39;darkorange&#39;</span><span class="p">,</span> <span class="s1">&#39;Complete&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">}</span>

<span class="c1"># Function to plot the data with different colors for each &#39;max_state&#39;</span>
<span class="k">def</span> <span class="nf">plot_data</span><span class="p">(</span><span class="n">point_size</span><span class="p">,</span> <span class="n">use_basemap</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="c1"># Plotting</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>  <span class="c1"># Set axes background to white</span>

    <span class="c1"># Determine bounds from the data</span>
    <span class="n">bounds</span> <span class="o">=</span> <span class="n">merged_gdf</span><span class="o">.</span><span class="n">total_bounds</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]])</span>

    <span class="c1"># Plot each category with its color</span>
    <span class="k">for</span> <span class="n">state</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">colors</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">data_to_plot</span> <span class="o">=</span> <span class="n">merged_gdf</span><span class="p">[</span><span class="n">merged_gdf</span><span class="p">[</span><span class="s1">&#39;max_state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">state</span><span class="p">]</span>
        <span class="n">data_to_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">point_size</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">state</span><span class="p">)</span>

    <span class="c1"># Add basemap if requested</span>
    <span class="k">if</span> <span class="n">use_basemap</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">merged_gdf</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">to_string</span><span class="p">(),</span> <span class="n">source</span><span class="o">=</span><span class="n">ctx</span><span class="o">.</span><span class="n">providers</span><span class="o">.</span><span class="n">CartoDB</span><span class="o">.</span><span class="n">Positron</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to load basemap: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Add legend and labels</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Damage State&#39;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Damage States of Buildings&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Longitude&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Latitude&#39;</span><span class="p">)</span>

    <span class="c1"># Show plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Example usage</span>
<span class="n">plot_data</span><span class="p">(</span><span class="n">point_size</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">use_basemap</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/29283bb580cb196840f468595d554797c256a85b569d195206962fe5f563682f.png" src="../_images/29283bb580cb196840f468595d554797c256a85b569d195206962fe5f563682f.png" />
</div>
</div>
</section>
<section id="id2">
<h4>2.6.2 Paper figure<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h4>
<img src="https://ars.els-cdn.com/content/image/1-s2.0-S2772741623000388-gr4_lrg.jpg" width="700"/></section>
</section>
</section>
<section id="electric-power-pole-damage">
<h2>3. Electric Power Pole Damage<a class="headerlink" href="#electric-power-pole-damage" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># EPF fragility mapping</span>
<span class="n">epf_mapping_id</span> <span class="o">=</span> <span class="s2">&quot;62fac92ecef2881193f22613&quot;</span>
<span class="n">epf_mapping_set</span> <span class="o">=</span> <span class="n">MappingSet</span><span class="p">(</span><span class="n">fragility_service</span><span class="o">.</span><span class="n">get_mapping</span><span class="p">(</span><span class="n">epf_mapping_id</span><span class="p">))</span>

<span class="n">epf_dmg_hurricane_galveston</span> <span class="o">=</span> <span class="n">EpfDamage</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">epf_dmg_hurricane_galveston</span><span class="o">.</span><span class="n">load_remote_input_dataset</span><span class="p">(</span><span class="s2">&quot;epfs&quot;</span><span class="p">,</span> <span class="s2">&quot;62fc000f88470b319561b58d&quot;</span><span class="p">)</span>
<span class="n">epf_dmg_hurricane_galveston</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s1">&#39;dfr3_mapping_set&#39;</span><span class="p">,</span> <span class="n">epf_mapping_set</span><span class="p">)</span>
<span class="n">epf_dmg_hurricane_galveston</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;result_name&quot;</span><span class="p">,</span> <span class="s2">&quot;Galveston-hurricane-epf-damage&quot;</span><span class="p">)</span>
<span class="n">epf_dmg_hurricane_galveston</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;fragility_key&quot;</span><span class="p">,</span> <span class="s2">&quot;Non-Retrofit Fragility ID Code&quot;</span><span class="p">)</span>
<span class="n">epf_dmg_hurricane_galveston</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;hazard_type&quot;</span><span class="p">,</span> <span class="n">hazard_type</span><span class="p">)</span>
<span class="n">epf_dmg_hurricane_galveston</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;hazard_id&quot;</span><span class="p">,</span> <span class="n">hazard_id</span><span class="p">)</span>
<span class="n">epf_dmg_hurricane_galveston</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;num_cpu&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>

<span class="c1"># Run Analysis</span>
<span class="n">epf_dmg_hurricane_galveston</span><span class="o">.</span><span class="n">run_analysis</span><span class="p">()</span>
<span class="n">epf_dmg_result</span> <span class="o">=</span> <span class="n">epf_dmg_hurricane_galveston</span><span class="o">.</span><span class="n">get_output_dataset</span><span class="p">(</span><span class="s2">&quot;result&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="monte-carlo-sampling">
<h2>4. Monte Carlo sampling<a class="headerlink" href="#monte-carlo-sampling" title="Permalink to this heading">#</a></h2>
<section id="id3">
<h3>4.1 Buildings<a class="headerlink" href="#id3" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mc</span> <span class="o">=</span> <span class="n">MonteCarloFailureProbability</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">mc</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s2">&quot;damage&quot;</span><span class="p">,</span> <span class="n">combined_dmg</span><span class="p">)</span>
<span class="n">mc</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;result_name&quot;</span><span class="p">,</span> <span class="s2">&quot;combined_bldg_mc&quot;</span><span class="p">)</span>
<span class="n">mc</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;num_cpu&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">mc</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;num_samples&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">mc</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;damage_interval_keys&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;DS_0&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_1&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_2&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_3&quot;</span><span class="p">])</span>
<span class="n">mc</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;failure_state_keys&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;DS_1&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_2&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_3&quot;</span><span class="p">])</span>
<span class="n">mc</span><span class="o">.</span><span class="n">run_analysis</span><span class="p">()</span>

<span class="n">gal_bldg_damage_mcs_samples</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">get_output_dataset</span><span class="p">(</span><span class="s1">&#39;sample_failure_state&#39;</span><span class="p">)</span>
<span class="n">gal_bldg_damage_mcs_samples_df</span> <span class="o">=</span> <span class="n">gal_bldg_damage_mcs_samples</span><span class="o">.</span><span class="n">get_dataframe_from_csv</span><span class="p">()</span>
<span class="n">gal_bldg_damage_mcs_samples_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>guid</th>
      <th>failure</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>f3a21b5f-0334-4d77-911f-faa9a45c92d7</td>
      <td>1,0,1,0,0,0,1,0,1,0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>80ab0289-8c72-4699-b12b-08ef2f2a5c91</td>
      <td>0,0,0,0,0,0,0,0,0,0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>7916eaa8-0bfa-4b32-84ff-20f19a520f5c</td>
      <td>1,1,1,1,1,1,1,1,0,1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>79008971-a534-4e45-9e40-43a2a904e59b</td>
      <td>1,1,1,1,1,1,0,0,0,0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2ad8ab6f-057f-468e-9911-6e92d9d4d01f</td>
      <td>1,1,0,1,1,0,1,1,0,0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="electric-power-poles">
<h3>4.2 Electric power poles<a class="headerlink" href="#electric-power-poles" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gal_bldg_failure_probability</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">get_output_dataset</span><span class="p">(</span><span class="s1">&#39;failure_probability&#39;</span><span class="p">)</span>  <span class="c1"># get buildings failure probabilities</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mc</span> <span class="o">=</span> <span class="n">MonteCarloFailureProbability</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">mc</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s2">&quot;damage&quot;</span><span class="p">,</span> <span class="n">epf_dmg_result</span><span class="p">)</span>
<span class="n">mc</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;result_name&quot;</span><span class="p">,</span> <span class="s2">&quot;epf_mc&quot;</span><span class="p">)</span>
<span class="n">mc</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;num_cpu&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">mc</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;num_samples&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">mc</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;damage_interval_keys&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;DS_0&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_1&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_2&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_3&quot;</span><span class="p">])</span>
<span class="n">mc</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;failure_state_keys&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;DS_1&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_2&quot;</span><span class="p">,</span> <span class="s2">&quot;DS_3&quot;</span><span class="p">])</span>
<span class="n">mc</span><span class="o">.</span><span class="n">run_analysis</span><span class="p">()</span>

<span class="n">gal_pole_damage_mcs_samples</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">get_output_dataset</span><span class="p">(</span><span class="s1">&#39;sample_failure_state&#39;</span><span class="p">)</span>
<span class="n">gal_pole_damage_mcs_samples_df</span> <span class="o">=</span> <span class="n">gal_pole_damage_mcs_samples</span><span class="o">.</span><span class="n">get_dataframe_from_csv</span><span class="p">()</span>
<span class="n">gal_pole_damage_mcs_samples_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>guid</th>
      <th>failure</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2525e200-cdc6-4fb8-9952-f17579176fd8</td>
      <td>1,1,1,1,1,1,1,1,1,1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>9180f947-26ae-40bd-85f5-83a80525f6c8</td>
      <td>1,1,1,1,1,1,1,1,1,1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>11ddc2dc-cc92-4c90-b4cc-a99b92a26f4b</td>
      <td>1,1,1,1,1,1,1,1,1,1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>9e58f196-9a2c-40b1-b722-69fa9c53c9d4</td>
      <td>1,1,1,1,1,1,1,1,1,1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>a4de2d54-b251-4a02-af0c-d12e0dc3670c</td>
      <td>1,1,1,1,1,1,1,1,1,1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="building-functionality">
<h2>5. Building functionality<a class="headerlink" href="#building-functionality" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gal_bldg_func</span> <span class="o">=</span> <span class="n">BuildingFunctionality</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
    
<span class="n">gal_bldg_func</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s2">&quot;building_damage_mcs_samples&quot;</span><span class="p">,</span> <span class="n">gal_bldg_damage_mcs_samples</span><span class="p">)</span>
<span class="n">gal_bldg_func</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s2">&quot;poles_damage_mcs_samples&quot;</span><span class="p">,</span> <span class="n">gal_pole_damage_mcs_samples</span><span class="p">)</span>
<span class="n">gal_bldg_func</span><span class="o">.</span><span class="n">load_remote_input_dataset</span><span class="p">(</span><span class="s2">&quot;interdependency_dictionary&quot;</span><span class="p">,</span> <span class="s2">&quot;63e5af0262d82d2f5a1058ea&quot;</span><span class="p">)</span>

<span class="n">gal_bldg_func</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;result_name&quot;</span><span class="p">,</span> <span class="s2">&quot;gal_mcs_functionality_probability&quot;</span><span class="p">)</span>
<span class="n">gal_bldg_func</span><span class="o">.</span><span class="n">run_analysis</span><span class="p">()</span>

<span class="n">gal_bldg_func_samples_df</span> <span class="o">=</span> <span class="n">gal_bldg_func</span><span class="o">.</span><span class="n">get_output_dataset</span><span class="p">(</span><span class="s1">&#39;functionality_samples&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_dataframe_from_csv</span><span class="p">()</span>
<span class="n">gal_bldg_func_samples_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>building_guid</th>
      <th>samples</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>f3a21b5f-0334-4d77-911f-faa9a45c92d7</td>
      <td>1,0,1,0,0,0,1,0,1,0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>80ab0289-8c72-4699-b12b-08ef2f2a5c91</td>
      <td>0,0,0,0,0,0,0,0,0,0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>7916eaa8-0bfa-4b32-84ff-20f19a520f5c</td>
      <td>1,1,1,1,1,1,1,1,0,1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>79008971-a534-4e45-9e40-43a2a904e59b</td>
      <td>1,0,1,1,0,0,0,0,0,0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2ad8ab6f-057f-468e-9911-6e92d9d4d01f</td>
      <td>1,1,0,1,1,0,1,1,0,0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_gal_bldg_func_probability</span> <span class="o">=</span> <span class="n">gal_bldg_func</span><span class="o">.</span><span class="n">get_output_dataset</span><span class="p">(</span><span class="s1">&#39;functionality_probability&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_dataframe_from_csv</span><span class="p">()</span>
<span class="n">df_gal_bldg_func_probability</span> <span class="o">=</span> <span class="n">df_gal_bldg_func_probability</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;building_guid&quot;</span><span class="p">:</span> <span class="s2">&quot;guid&quot;</span><span class="p">})</span>
<span class="n">func_prob_target</span> <span class="o">=</span> <span class="mf">0.50</span>
<span class="n">df_gal_bldg_func_probability</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_gal_bldg_func_probability</span><span class="p">[</span><span class="s1">&#39;probability&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">(),</span> <span class="s1">&#39;functionality&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># Assumed to be connected to an undamaged/unanalyzed power network for now.</span>
<span class="n">df_gal_bldg_func_probability</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_gal_bldg_func_probability</span><span class="p">[</span><span class="s1">&#39;probability&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">func_prob_target</span><span class="p">,</span> <span class="s1">&#39;functionality&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Non-Functional</span>
<span class="n">df_gal_bldg_func_probability</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_gal_bldg_func_probability</span><span class="p">[</span><span class="s1">&#39;probability&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">func_prob_target</span><span class="p">,</span> <span class="s1">&#39;functionality&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># Functional</span>
<span class="n">df_gal_bldg_func_probability</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_gal_bldg_func_probability</span><span class="p">[</span><span class="s1">&#39;probability&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">(),</span> <span class="s1">&#39;functionality_state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Functional&#39;</span> <span class="c1"># Assumed to be connected to an undamaged/unanalyzed power network for now.</span>
<span class="n">df_gal_bldg_func_probability</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_gal_bldg_func_probability</span><span class="p">[</span><span class="s1">&#39;probability&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">func_prob_target</span><span class="p">,</span> <span class="s1">&#39;functionality_state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Non-Functional&#39;</span> <span class="c1"># Non-Functional</span>
<span class="n">df_gal_bldg_func_probability</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_gal_bldg_func_probability</span><span class="p">[</span><span class="s1">&#39;probability&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">func_prob_target</span><span class="p">,</span> <span class="s1">&#39;functionality_state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Functional&#39;</span> <span class="c1"># Functional</span>
<span class="n">df_gal_bldg_func_probability</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>guid</th>
      <th>probability</th>
      <th>functionality</th>
      <th>functionality_state</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>f3a21b5f-0334-4d77-911f-faa9a45c92d7</td>
      <td>0.4</td>
      <td>0.0</td>
      <td>Non-Functional</td>
    </tr>
    <tr>
      <th>1</th>
      <td>80ab0289-8c72-4699-b12b-08ef2f2a5c91</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>Non-Functional</td>
    </tr>
    <tr>
      <th>2</th>
      <td>7916eaa8-0bfa-4b32-84ff-20f19a520f5c</td>
      <td>0.9</td>
      <td>1.0</td>
      <td>Functional</td>
    </tr>
    <tr>
      <th>3</th>
      <td>79008971-a534-4e45-9e40-43a2a904e59b</td>
      <td>0.3</td>
      <td>0.0</td>
      <td>Non-Functional</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2ad8ab6f-057f-468e-9911-6e92d9d4d01f</td>
      <td>0.6</td>
      <td>1.0</td>
      <td>Functional</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### Plot of the distribution of functionality state for buildings</span>
<span class="n">indexes</span> <span class="o">=</span> <span class="n">df_gal_bldg_func_probability</span><span class="p">[</span><span class="s1">&#39;functionality_state&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">values</span> <span class="o">=</span> <span class="n">df_gal_bldg_func_probability</span><span class="p">[</span><span class="s1">&#39;functionality_state&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>

<span class="n">bars</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">indexes</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">values</span><span class="p">,)</span>

<span class="k">for</span> <span class="n">bar</span> <span class="ow">in</span> <span class="n">bars</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">bar</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span> <span class="o">+</span> <span class="n">bar</span><span class="o">.</span><span class="n">get_width</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="n">bar</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span><span class="sa">f</span><span class="s1">&#39;% </span><span class="si">{</span><span class="n">bar</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span><span class="w"> </span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Damage State&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Percentage&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Functionality percentage (considering buildings and power)&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">frame_on</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/f07becce2b374152ab503fb02c374b8041ffc8e378d41f7ed1798b932cb462fb.png" src="../_images/f07becce2b374152ab503fb02c374b8041ffc8e378d41f7ed1798b932cb462fb.png" />
</div>
</div>
</section>
<section id="capital-shocks">
<h2>6. Capital Shocks<a class="headerlink" href="#capital-shocks" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create Capital shocks analysis</span>
<span class="n">capital_shocks</span> <span class="o">=</span> <span class="n">CapitalShocks</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">building_to_sectors_id</span> <span class="o">=</span> <span class="s2">&quot;640200da475d895dfc2de1bd&quot;</span>
<span class="c1"># Load remote datasets</span>
<span class="n">capital_shocks</span><span class="o">.</span><span class="n">load_remote_input_dataset</span><span class="p">(</span><span class="s2">&quot;buildings_to_sectors&quot;</span><span class="p">,</span> <span class="n">building_to_sectors_id</span><span class="p">)</span>
<span class="n">capital_shocks</span><span class="o">.</span><span class="n">load_remote_input_dataset</span><span class="p">(</span><span class="s2">&quot;buildings&quot;</span><span class="p">,</span> <span class="n">bldg_dataset_id</span><span class="p">)</span>
<span class="n">capital_shocks</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s2">&quot;failure_probability&quot;</span><span class="p">,</span> <span class="n">gal_bldg_failure_probability</span><span class="p">)</span>

<span class="n">capital_shocks</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;result_name&quot;</span><span class="p">,</span> <span class="s2">&quot;sector_shocks&quot;</span><span class="p">)</span> <span class="c1"># name of csv file with results</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run capital shocks analysis</span>
<span class="n">capital_shocks</span><span class="o">.</span><span class="n">run_analysis</span><span class="p">()</span>

<span class="n">sector_shocks_result</span> <span class="o">=</span> <span class="n">capital_shocks</span><span class="o">.</span><span class="n">get_output_dataset</span><span class="p">(</span><span class="s2">&quot;sector_shocks&quot;</span><span class="p">)</span>
<span class="n">sector_shocks_result</span><span class="o">.</span><span class="n">get_dataframe_from_csv</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sector</th>
      <th>shock</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>HS3I</td>
      <td>0.231995</td>
    </tr>
    <tr>
      <th>1</th>
      <td>HS2I</td>
      <td>0.170012</td>
    </tr>
    <tr>
      <th>2</th>
      <td>HS1I</td>
      <td>0.256569</td>
    </tr>
    <tr>
      <th>3</th>
      <td>IPROFSER</td>
      <td>0.336513</td>
    </tr>
    <tr>
      <th>4</th>
      <td>IRETAIL</td>
      <td>0.312660</td>
    </tr>
    <tr>
      <th>5</th>
      <td>IART</td>
      <td>0.335676</td>
    </tr>
    <tr>
      <th>6</th>
      <td>ICONS</td>
      <td>0.215296</td>
    </tr>
    <tr>
      <th>7</th>
      <td>IHEALTH</td>
      <td>0.332826</td>
    </tr>
    <tr>
      <th>8</th>
      <td>ITRANS</td>
      <td>0.189783</td>
    </tr>
    <tr>
      <th>9</th>
      <td>IREALE</td>
      <td>0.373701</td>
    </tr>
    <tr>
      <th>10</th>
      <td>IACCO</td>
      <td>0.352485</td>
    </tr>
    <tr>
      <th>11</th>
      <td>IUTIL</td>
      <td>0.616384</td>
    </tr>
    <tr>
      <th>12</th>
      <td>IAGMIN</td>
      <td>0.058899</td>
    </tr>
    <tr>
      <th>13</th>
      <td>IEDU</td>
      <td>0.608555</td>
    </tr>
    <tr>
      <th>14</th>
      <td>IWHOLE</td>
      <td>0.098623</td>
    </tr>
    <tr>
      <th>15</th>
      <td>IMANU</td>
      <td>0.279228</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="population-dislocation-multihazard-comparison">
<h2>7. Population dislocation - Multihazard Comparison<a class="headerlink" href="#population-dislocation-multihazard-comparison" title="Permalink to this heading">#</a></h2>
<section id="setup-general-population-data">
<h3>7.1 Setup general population data<a class="headerlink" href="#setup-general-population-data" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pop_dis</span> <span class="o">=</span> <span class="n">PopulationDislocation</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">value_loss</span> <span class="o">=</span> <span class="s2">&quot;60354810e379f22e16560dbd&quot;</span>
<span class="n">bg_data</span> <span class="o">=</span> <span class="s2">&quot;603545f2dcda03378087e708&quot;</span>
<span class="c1"># hua_result_id = &quot;63ee615d62b9d001e6a2b660&quot; # city</span>
<span class="n">hua_result_id</span> <span class="o">=</span> <span class="s2">&quot;63ff8e895367c2261b4cb2ef&quot;</span> <span class="c1"># island</span>

<span class="n">pop_dis</span><span class="o">.</span><span class="n">load_remote_input_dataset</span><span class="p">(</span><span class="s2">&quot;block_group_data&quot;</span><span class="p">,</span> <span class="n">bg_data</span><span class="p">)</span>
<span class="n">pop_dis</span><span class="o">.</span><span class="n">load_remote_input_dataset</span><span class="p">(</span><span class="s2">&quot;value_loss_param&quot;</span><span class="p">,</span> <span class="n">value_loss</span><span class="p">)</span>
<span class="n">pop_dis</span><span class="o">.</span><span class="n">load_remote_input_dataset</span><span class="p">(</span><span class="s2">&quot;housing_unit_allocation&quot;</span><span class="p">,</span> <span class="n">hua_result_id</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="initial-loop-for-dislocation">
<h3>7.2 Initial loop for dislocation<a class="headerlink" href="#initial-loop-for-dislocation" title="Permalink to this heading">#</a></h3>
<p>The following code is used to create a set of dateframes for each hazard type and the combined damage. Each data frame has details on the population dislocation for the hazard.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create an empty dictionary to store the results</span>
<span class="n">popdis_results_df</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">popdis_results_df_mincols</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">damage_types</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;flood_damage&quot;</span> <span class="p">:</span> <span class="n">flood_damage</span><span class="p">,</span>
                <span class="s2">&quot;wind_damage&quot;</span> <span class="p">:</span> <span class="n">wind_damage</span><span class="p">,</span>
                <span class="s2">&quot;surge_wave_damage&quot;</span> <span class="p">:</span> <span class="n">surge_wave_damage</span><span class="p">,</span>
                <span class="s2">&quot;combined_dmg&quot;</span> <span class="p">:</span> <span class="n">combined_dmg</span><span class="p">}</span>

<span class="c1"># loop through the damage types</span>
<span class="k">for</span> <span class="n">damage</span><span class="p">,</span> <span class="n">damage_result</span> <span class="ow">in</span> <span class="n">damage_types</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">pop_dis</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s2">&quot;building_dmg&quot;</span><span class="p">,</span> <span class="n">damage_result</span><span class="p">)</span>

    <span class="n">result_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;galveston-pop-disl-results_</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="mi">1111</span>

    <span class="n">pop_dis</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;result_name&quot;</span><span class="p">,</span> <span class="n">result_name</span><span class="p">)</span>
    <span class="n">pop_dis</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;seed&quot;</span><span class="p">,</span> <span class="n">seed</span><span class="p">)</span>
    <span class="n">pop_dis</span><span class="o">.</span><span class="n">run_analysis</span><span class="p">()</span>

    <span class="n">population_dislocation_result</span> <span class="o">=</span> <span class="n">pop_dis</span><span class="o">.</span><span class="n">get_output_dataset</span><span class="p">(</span><span class="s2">&quot;result&quot;</span><span class="p">)</span>
    <span class="n">popdis_results_df</span><span class="p">[</span><span class="n">damage</span><span class="p">]</span> <span class="o">=</span> <span class="n">population_dislocation_result</span><span class="o">.</span><span class="n">get_dataframe_from_csv</span><span class="p">(</span><span class="n">low_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Keep HUID, prdis and dislocated columns</span>
    <span class="n">popdis_results_df_mincols</span><span class="p">[</span><span class="n">damage</span><span class="p">]</span> <span class="o">=</span> <span class="n">popdis_results_df</span><span class="p">[</span><span class="n">damage</span><span class="p">][[</span><span class="s1">&#39;guid&#39;</span><span class="p">,</span><span class="s1">&#39;huid&#39;</span><span class="p">,</span> <span class="s1">&#39;prdis&#39;</span><span class="p">,</span> <span class="s1">&#39;dislocated&#39;</span><span class="p">]]</span>

    <span class="c1"># Print the number of dislocated housholds by HUID</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;For </span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">,</span><span class="n">popdis_results_df_mincols</span><span class="p">[</span><span class="n">damage</span><span class="p">][</span><span class="s1">&#39;dislocated&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="s2">&quot; households are dislocated&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>For flood_damage  10067  households are dislocated
For wind_damage  14292  households are dislocated
For surge_wave_damage  10007  households are dislocated
For combined_dmg  14896  households are dislocated
</pre></div>
</div>
</div>
</div>
</section>
<section id="clean-and-merge-dislocation-data">
<h3>7.3 Clean and merge dislocation data<a class="headerlink" href="#clean-and-merge-dislocation-data" title="Permalink to this heading">#</a></h3>
<p>The following code loops through the damage type dataframes, cleans up the columns and prepares the data for a merge.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">popdis_merge_df</span> <span class="o">=</span> <span class="p">{}</span>
<span class="c1"># loop through the damage types</span>
<span class="k">for</span> <span class="n">damage</span><span class="p">,</span> <span class="n">damage_result</span> <span class="ow">in</span> <span class="n">damage_types</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="c1"># Read in CSV and convert to dataframe</span>
    <span class="n">damage_df</span> <span class="o">=</span> <span class="n">damage_result</span><span class="o">.</span><span class="n">get_dataframe_from_csv</span><span class="p">(</span><span class="n">low_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># For each damage type merge damage states and hazard exposure</span>
    <span class="n">popdis_merge_df</span><span class="p">[</span><span class="n">damage</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
                                <span class="n">right</span> <span class="o">=</span> <span class="n">popdis_results_df_mincols</span><span class="p">[</span><span class="n">damage</span><span class="p">],</span> 
                                <span class="n">left</span> <span class="o">=</span> <span class="n">damage_df</span><span class="p">[[</span><span class="s1">&#39;guid&#39;</span><span class="p">,</span><span class="s1">&#39;DS_0&#39;</span><span class="p">,</span><span class="s1">&#39;DS_1&#39;</span><span class="p">,</span><span class="s1">&#39;DS_2&#39;</span><span class="p">,</span><span class="s1">&#39;DS_3&#39;</span><span class="p">,</span><span class="s1">&#39;haz_expose&#39;</span><span class="p">]],</span> 
                                <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;guid&#39;</span><span class="p">,</span> 
                                <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;guid&#39;</span><span class="p">,</span> 
                                <span class="n">how</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>

    <span class="c1"># flag observations with damage exposure</span>
    <span class="n">condition1</span> <span class="o">=</span> <span class="p">(</span><span class="n">popdis_merge_df</span><span class="p">[</span><span class="n">damage</span><span class="p">][</span><span class="s1">&#39;haz_expose&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">)</span>
    <span class="n">popdis_merge_df</span><span class="p">[</span><span class="n">damage</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s1">_exp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">condition1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1"># flag observations that are not dislocated and DS_3 &gt; .5</span>
    <span class="c1"># households that do not dislocate but have a high probability of damage</span>
    <span class="n">condition1</span> <span class="o">=</span> <span class="p">(</span><span class="n">popdis_merge_df</span><span class="p">[</span><span class="n">damage</span><span class="p">][</span><span class="s1">&#39;dislocated&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">condition2</span> <span class="o">=</span> <span class="p">(</span><span class="n">popdis_merge_df</span><span class="p">[</span><span class="n">damage</span><span class="p">][</span><span class="s1">&#39;DS_3&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">.5</span><span class="p">)</span>
    <span class="n">popdis_merge_df</span><span class="p">[</span><span class="n">damage</span><span class="p">][</span><span class="s1">&#39;dsds3flag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">condition1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">condition2</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1"># flag observations that are dislocated and DS_0 &gt; .5</span>
    <span class="c1"># households that dislocate but have a low probability of damage</span>
    <span class="n">condition1</span> <span class="o">=</span> <span class="p">(</span><span class="n">popdis_merge_df</span><span class="p">[</span><span class="n">damage</span><span class="p">][</span><span class="s1">&#39;dislocated&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">condition2</span> <span class="o">=</span> <span class="p">(</span><span class="n">popdis_merge_df</span><span class="p">[</span><span class="n">damage</span><span class="p">][</span><span class="s1">&#39;DS_0&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">.5</span><span class="p">)</span>
    <span class="n">popdis_merge_df</span><span class="p">[</span><span class="n">damage</span><span class="p">][</span><span class="s1">&#39;dsds0flag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">condition1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">condition2</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1"># rename popdis_merge_df with damage type</span>
    <span class="n">popdis_merge_df</span><span class="p">[</span><span class="n">damage</span><span class="p">]</span> <span class="o">=</span> <span class="n">popdis_merge_df</span><span class="p">[</span><span class="n">damage</span><span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;dsds3flag&quot;</span> <span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;dsds3flag_</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                                                                     <span class="s2">&quot;dsds0flag&quot;</span> <span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;dsds0flag_</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                                                                     <span class="s2">&quot;guid&quot;</span> <span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;guid_</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                                                                     <span class="s2">&quot;prdis&quot;</span> <span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;prdis_</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                                                                     <span class="s2">&quot;dislocated&quot;</span> <span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;dislocated_</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                                                                     <span class="s2">&quot;DS_0&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;DS_0_</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                                                                     <span class="s2">&quot;DS_1&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;DS_1_</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>  
                                                                     <span class="s2">&quot;DS_2&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;DS_2_</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                                                                     <span class="s2">&quot;DS_3&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;DS_3_</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                                                                     <span class="s2">&quot;haz_expose&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;haz_expose_</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">})</span>

   

<span class="c1"># merge all the damage types</span>
<span class="n">popdis_multihazard_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">right</span> <span class="o">=</span> <span class="n">popdis_merge_df</span><span class="p">[</span><span class="s1">&#39;flood_damage&#39;</span><span class="p">],</span>
                                    <span class="n">left</span> <span class="o">=</span> <span class="n">popdis_merge_df</span><span class="p">[</span><span class="s1">&#39;wind_damage&#39;</span><span class="p">],</span>
                                    <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;huid&#39;</span><span class="p">,</span>
                                    <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;huid&#39;</span><span class="p">,</span>
                                    <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
<span class="n">popdis_multihazard_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">right</span> <span class="o">=</span> <span class="n">popdis_multihazard_df</span><span class="p">,</span>
                                    <span class="n">left</span> <span class="o">=</span> <span class="n">popdis_merge_df</span><span class="p">[</span><span class="s1">&#39;surge_wave_damage&#39;</span><span class="p">],</span>
                                    <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;huid&#39;</span><span class="p">,</span>
                                    <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;huid&#39;</span><span class="p">,</span>
                                    <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>                              
<span class="n">popdis_multihazard_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">right</span> <span class="o">=</span> <span class="n">popdis_multihazard_df</span><span class="p">,</span>
                                    <span class="n">left</span> <span class="o">=</span> <span class="n">popdis_merge_df</span><span class="p">[</span><span class="s1">&#39;combined_dmg&#39;</span><span class="p">],</span>
                                    <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;huid&#39;</span><span class="p">,</span>
                                    <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;huid&#39;</span><span class="p">,</span>
                                    <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
<span class="c1"># drop all the guid columns and rename guid_x to guid</span>
<span class="n">popdis_multihazard_df</span> <span class="o">=</span> <span class="n">popdis_multihazard_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;guid_flood_damage&#39;</span><span class="p">,</span><span class="s1">&#39;guid_wind_damage&#39;</span><span class="p">,</span><span class="s1">&#39;guid_surge_wave_damage&#39;</span><span class="p">])</span>
<span class="n">popdis_multihazard_df</span> <span class="o">=</span> <span class="n">popdis_multihazard_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;guid_combined_dmg&quot;</span> <span class="p">:</span> <span class="s2">&quot;guid&quot;</span><span class="p">})</span>   
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">popdis_multihazard_df</span><span class="o">.</span><span class="n">columns</span>
<span class="c1">#popdis_multihazard_df.to_csv(&#39;./output/building/dislocation_results/dislocation_building.csv&#39;, index=False)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;guid&#39;, &#39;DS_0_combined_dmg&#39;, &#39;DS_1_combined_dmg&#39;, &#39;DS_2_combined_dmg&#39;,
       &#39;DS_3_combined_dmg&#39;, &#39;haz_expose_combined_dmg&#39;, &#39;huid&#39;,
       &#39;prdis_combined_dmg&#39;, &#39;dislocated_combined_dmg&#39;, &#39;combined_dmg_exp&#39;,
       &#39;dsds3flag_combined_dmg&#39;, &#39;dsds0flag_combined_dmg&#39;,
       &#39;DS_0_surge_wave_damage&#39;, &#39;DS_1_surge_wave_damage&#39;,
       &#39;DS_2_surge_wave_damage&#39;, &#39;DS_3_surge_wave_damage&#39;,
       &#39;haz_expose_surge_wave_damage&#39;, &#39;prdis_surge_wave_damage&#39;,
       &#39;dislocated_surge_wave_damage&#39;, &#39;surge_wave_damage_exp&#39;,
       &#39;dsds3flag_surge_wave_damage&#39;, &#39;dsds0flag_surge_wave_damage&#39;,
       &#39;DS_0_wind_damage&#39;, &#39;DS_1_wind_damage&#39;, &#39;DS_2_wind_damage&#39;,
       &#39;DS_3_wind_damage&#39;, &#39;haz_expose_wind_damage&#39;, &#39;prdis_wind_damage&#39;,
       &#39;dislocated_wind_damage&#39;, &#39;wind_damage_exp&#39;, &#39;dsds3flag_wind_damage&#39;,
       &#39;dsds0flag_wind_damage&#39;, &#39;DS_0_flood_damage&#39;, &#39;DS_1_flood_damage&#39;,
       &#39;DS_2_flood_damage&#39;, &#39;DS_3_flood_damage&#39;, &#39;haz_expose_flood_damage&#39;,
       &#39;prdis_flood_damage&#39;, &#39;dislocated_flood_damage&#39;, &#39;flood_damage_exp&#39;,
       &#39;dsds3flag_flood_damage&#39;, &#39;dsds0flag_flood_damage&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
</section>
<section id="merge-in-infrastructure-analyses-on-transportation-and-power">
<h3>7.4 Merge in infrastructure analyses on transportation and power<a class="headerlink" href="#merge-in-infrastructure-analyses-on-transportation-and-power" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># read in insfrastructure result from a CSV file</span>
<span class="n">networkdamage_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;./data/infrastructures_recovery_result/final_df_with_building.csv&quot;</span><span class="p">)</span>

<span class="c1"># for network df keep only the first unique guid - todo: This probably needs to be changed</span>
<span class="n">networkdamage_df</span> <span class="o">=</span> <span class="n">networkdamage_df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;guid&#39;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)</span>
<span class="n">networkdamage_df</span><span class="p">[</span><span class="s1">&#39;guid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>

<span class="c1"># keep guid, power_back_time, transpo_back_time</span>
<span class="n">networkdamage_df</span> <span class="o">=</span> <span class="n">networkdamage_df</span><span class="p">[[</span><span class="s1">&#39;guid&#39;</span><span class="p">,</span><span class="s1">&#39;average_power_back_time&#39;</span><span class="p">,</span><span class="s1">&#39;average_transpo_back_time&#39;</span><span class="p">]]</span>

<span class="c1"># Considering with and without power/transpo in the next analyses</span>
<span class="c1">#networkdamage_df[&#39;average_transpo_back_time&#39;] = 0.0   # Uncomment to exclude the impact of transportation on population displacement.</span>
<span class="c1">#networkdamage_df[&#39;average_power_back_time&#39;] = 0.0   # Uncomment to exclude the impact of power on population displacement.</span>
<span class="n">networkdamage_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>guid</th>
      <th>average_power_back_time</th>
      <th>average_transpo_back_time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7916eaa8-0bfa-4b32-84ff-20f19a520f5c</td>
      <td>0.000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>42167885-ea18-41b4-be8c-5c09c330d312</td>
      <td>5.836</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3dab0b4b-42eb-4df6-a5e1-c1882df41704</td>
      <td>0.000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>e474c4ef-a091-47ab-85b4-ef0459e37834</td>
      <td>0.000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>73</th>
      <td>335d18da-7a60-4f4d-8c97-d35e0f3a1360</td>
      <td>0.000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>33297</th>
      <td>7a415cb6-d212-450b-b139-f005c89b9656</td>
      <td>0.000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>33298</th>
      <td>74e5fedf-9e22-4434-9128-65ca793df7d2</td>
      <td>0.000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>33299</th>
      <td>1ac5be10-582c-46b2-91ed-469f684bb886</td>
      <td>0.000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>33300</th>
      <td>fbcfb6d6-de13-42fa-9839-d7c80afc651d</td>
      <td>0.000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>33301</th>
      <td>2ee961c9-cd94-499e-b1fe-3e0220a440ea</td>
      <td>0.000</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>22015 rows × 3 columns</p>
</div></div></div>
</div>
<img src="https://ars.els-cdn.com/content/image/1-s2.0-S2772741623000388-gr7_lrg.jpg" width="700"/>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">networkdamage_df</span><span class="p">[</span><span class="s1">&#39;guid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count                                    22015
unique                                   22015
top       7916eaa8-0bfa-4b32-84ff-20f19a520f5c
freq                                         1
Name: guid, dtype: object
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">popdis_multihazard_df</span><span class="p">[</span><span class="s1">&#39;guid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count                                    33302
unique                                   22015
top       2669f722-ae95-4181-90a8-9c4755b7b29c
freq                                       191
Name: guid, dtype: object
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># merge network damage with popdis_multihazard_df by guid</span>
<span class="n">popdis_multihazard_network_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">right</span> <span class="o">=</span> <span class="n">popdis_multihazard_df</span><span class="p">,</span>
                                    <span class="n">left</span> <span class="o">=</span> <span class="n">networkdamage_df</span><span class="p">,</span>
                                    <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;guid&#39;</span><span class="p">,</span>
                                    <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;guid&#39;</span><span class="p">,</span>
                                    <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>
<span class="n">popdis_multihazard_network_df</span><span class="p">[</span><span class="s1">&#39;guid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count                                    33302
unique                                   22015
top       2669f722-ae95-4181-90a8-9c4755b7b29c
freq                                       191
Name: guid, dtype: object
</pre></div>
</div>
</div>
</div>
</section>
<section id="add-flag-for-power-outage-and-road-closure">
<h3>7.5 Add Flag for Power Outage and Road Closure<a class="headerlink" href="#add-flag-for-power-outage-and-road-closure" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Choosing cutoffs for 3 days without power and 7 days without road access.</p></li>
<li><p>These cutoffs are expert judgments and could be changed.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># If the power_back_time greater than 7 days then dislocated_power = 1</span>
<span class="n">condition1</span> <span class="o">=</span> <span class="p">(</span><span class="n">popdis_multihazard_network_df</span><span class="p">[</span><span class="s1">&#39;average_power_back_time&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">popdis_multihazard_network_df</span><span class="p">[</span><span class="s1">&#39;powerflag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">condition1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># if transpo_back_time greater than 14 days then dislocated_transpo = 1</span>
<span class="n">condition1</span> <span class="o">=</span> <span class="p">(</span><span class="n">popdis_multihazard_network_df</span><span class="p">[</span><span class="s1">&#39;average_transpo_back_time&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">popdis_multihazard_network_df</span><span class="p">[</span><span class="s1">&#39;transpoflag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">condition1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># loop through the damage types</span>
<span class="k">for</span> <span class="n">damage</span><span class="p">,</span> <span class="n">damage_result</span> <span class="ow">in</span> <span class="n">damage_types</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="c1"># add case where dislocated = 0 but dislocated_power == 1</span>
    <span class="n">condition1</span> <span class="o">=</span> <span class="p">(</span><span class="n">popdis_multihazard_network_df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;dislocated_</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">condition2</span> <span class="o">=</span> <span class="p">(</span><span class="n">popdis_multihazard_network_df</span><span class="p">[</span><span class="s1">&#39;powerflag&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">popdis_multihazard_network_df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;powerflag_</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> \
        <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">condition1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">condition2</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    
    <span class="c1"># add case where dislocated = 0 but dislocated_transpo == 1</span>
    <span class="n">condition1</span> <span class="o">=</span> <span class="p">(</span><span class="n">popdis_multihazard_network_df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;dislocated_</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">condition2</span> <span class="o">=</span> <span class="p">(</span><span class="n">popdis_multihazard_network_df</span><span class="p">[</span><span class="s1">&#39;transpoflag&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">popdis_multihazard_network_df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;transpoflag_</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> \
        <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">condition1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">condition2</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    
    <span class="c1"># identify safe occupany housholds no flags </span>
    <span class="n">condition1</span> <span class="o">=</span> <span class="p">(</span><span class="n">popdis_multihazard_network_df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;dsds3flag_</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">condition2</span> <span class="o">=</span> <span class="p">(</span><span class="n">popdis_multihazard_network_df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;dsds0flag_</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">condition3</span> <span class="o">=</span> <span class="p">(</span><span class="n">popdis_multihazard_network_df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;powerflag_</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">condition4</span> <span class="o">=</span> <span class="p">(</span><span class="n">popdis_multihazard_network_df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;transpoflag_</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">popdis_multihazard_network_df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;safeflag_</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> \
        <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">condition1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">condition2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">condition3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">condition4</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1"># how many households have hazard exposure = yes</span>
    <span class="n">hazexpose</span> <span class="o">=</span> <span class="n">popdis_multihazard_network_df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s1">_exp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="c1"># how many households have dsds0flag or dsds3flag true</span>
    <span class="n">totaldislocation</span> <span class="o">=</span> <span class="n">popdis_multihazard_network_df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;dislocated_</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">choicedislocation</span> <span class="o">=</span> <span class="n">popdis_multihazard_network_df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;dsds0flag_</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">hazardnondislocation</span> <span class="o">=</span> <span class="n">popdis_multihazard_network_df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;dsds3flag_</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">nopower_nodislocation</span> <span class="o">=</span> <span class="n">popdis_multihazard_network_df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;powerflag_</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">notranspo_nodislocation</span> <span class="o">=</span> <span class="n">popdis_multihazard_network_df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;transpoflag_</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">safe_occupancy</span> <span class="o">=</span> <span class="n">popdis_multihazard_network_df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;safeflag_</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s2"> Number of households with hazard exposure: </span><span class="si">{</span><span class="n">hazexpose</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s2"> Total number of dislocated households: </span><span class="si">{</span><span class="n">totaldislocation</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s2"> Number of households that dislocate but have a low probability of damage: </span><span class="si">{</span><span class="n">choicedislocation</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s2"> Number of households that do not dislocate and have no power: </span><span class="si">{</span><span class="n">nopower_nodislocation</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s2"> Number of households that do not dislocate and have no connectivity to mainland: </span><span class="si">{</span><span class="n">notranspo_nodislocation</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s2"> Number of households with safe occupancy: </span><span class="si">{</span><span class="n">safe_occupancy</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>flood_damage Number of households with hazard exposure: 32964
flood_damage Total number of dislocated households: 10067
flood_damage Number of households that dislocate but have a low probability of damage: 1190
flood_damage Number of households that do not dislocate and have no power: 4821
flood_damage Number of households that do not dislocate and have no connectivity to mainland: 5581
flood_damage Number of households with safe occupancy: 25638
wind_damage Number of households with hazard exposure: 33295
wind_damage Total number of dislocated households: 14292
wind_damage Number of households that dislocate but have a low probability of damage: 1989
wind_damage Number of households that do not dislocate and have no power: 3307
wind_damage Number of households that do not dislocate and have no connectivity to mainland: 3802
wind_damage Number of households with safe occupancy: 26749
surge_wave_damage Number of households with hazard exposure: 30463
surge_wave_damage Total number of dislocated households: 10007
surge_wave_damage Number of households that dislocate but have a low probability of damage: 1391
surge_wave_damage Number of households that do not dislocate and have no power: 4514
surge_wave_damage Number of households that do not dislocate and have no connectivity to mainland: 5372
surge_wave_damage Number of households with safe occupancy: 25756
combined_dmg Number of households with hazard exposure: 33295
combined_dmg Total number of dislocated households: 14896
combined_dmg Number of households that dislocate but have a low probability of damage: 1333
combined_dmg Number of households that do not dislocate and have no power: 3142
combined_dmg Number of households that do not dislocate and have no connectivity to mainland: 3655
combined_dmg Number of households with safe occupancy: 27506
</pre></div>
</div>
</div>
</div>
</section>
<section id="modify-dislocation-for-hhsr">
<h3>7.6 Modify dislocation for HHSR<a class="headerlink" href="#modify-dislocation-for-hhsr" title="Permalink to this heading">#</a></h3>
<p>The HHSR model assumes that if a household dislocates then the structure is not safe to occupy and will take time to recover. However, the dislocation model has households that dislocate but the structure has a high probability of being safe to occupy. Vice versa, the model also has households that do not dislcate but the structure has a high probability of being unsafe to occupy.</p>
<p>If a household has choice dislocation (dsds0flag_) then dislocation should be set to 0.</p>
<p>If a household has unsafe occupancy (dsds3flag_) then dislocation should be set to 1.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">popdis_hhrs_df</span> <span class="o">=</span> <span class="n">popdis_multihazard_network_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># loop through the damage types</span>
<span class="k">for</span> <span class="n">damage</span><span class="p">,</span> <span class="n">damage_result</span> <span class="ow">in</span> <span class="n">damage_types</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="c1"># update dislocation if dsds0flag_ = 1</span>
    <span class="n">totaldislocation1</span> <span class="o">=</span> <span class="n">popdis_hhrs_df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;dislocated_</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">condition1</span> <span class="o">=</span> <span class="p">(</span><span class="n">popdis_hhrs_df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;dsds0flag_</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">popdis_hhrs_df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;dislocated_</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> \
        <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">condition1</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">popdis_hhrs_df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;dislocated_</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">])</span>
    <span class="n">totaldislocation2</span> <span class="o">=</span> <span class="n">popdis_hhrs_df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;dislocated_</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s2"> Swith Choice Dislocation Total number of dislocated households: </span><span class="si">{</span><span class="n">totaldislocation1</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">totaldislocation2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># update dislocation if dsds3flag_ = 1</span>
    <span class="n">totaldislocation1</span> <span class="o">=</span> <span class="n">popdis_hhrs_df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;dislocated_</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">condition1</span> <span class="o">=</span> <span class="p">(</span><span class="n">popdis_hhrs_df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;dsds3flag_</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">popdis_hhrs_df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;dislocated_</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> \
        <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">condition1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">popdis_hhrs_df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;dislocated_</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">])</span>
    <span class="n">totaldislocation2</span> <span class="o">=</span> <span class="n">popdis_hhrs_df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;dislocated_</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s2"> Switch unsafe occupancy Total number of dislocated households: </span><span class="si">{</span><span class="n">totaldislocation1</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">totaldislocation2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>flood_damage Swith Choice Dislocation Total number of dislocated households: 10067 8877
flood_damage Switch unsafe occupancy Total number of dislocated households: 8877 8971
wind_damage Swith Choice Dislocation Total number of dislocated households: 14292 12303
wind_damage Switch unsafe occupancy Total number of dislocated households: 12303 12715
surge_wave_damage Swith Choice Dislocation Total number of dislocated households: 10007 8616
surge_wave_damage Switch unsafe occupancy Total number of dislocated households: 8616 8909
combined_dmg Swith Choice Dislocation Total number of dislocated households: 14896 13563
combined_dmg Switch unsafe occupancy Total number of dislocated households: 13563 14288
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">popdis_hhrs_df</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;guid&#39;, &#39;average_power_back_time&#39;, &#39;average_transpo_back_time&#39;,
       &#39;DS_0_combined_dmg&#39;, &#39;DS_1_combined_dmg&#39;, &#39;DS_2_combined_dmg&#39;,
       &#39;DS_3_combined_dmg&#39;, &#39;haz_expose_combined_dmg&#39;, &#39;huid&#39;,
       &#39;prdis_combined_dmg&#39;, &#39;dislocated_combined_dmg&#39;, &#39;combined_dmg_exp&#39;,
       &#39;dsds3flag_combined_dmg&#39;, &#39;dsds0flag_combined_dmg&#39;,
       &#39;DS_0_surge_wave_damage&#39;, &#39;DS_1_surge_wave_damage&#39;,
       &#39;DS_2_surge_wave_damage&#39;, &#39;DS_3_surge_wave_damage&#39;,
       &#39;haz_expose_surge_wave_damage&#39;, &#39;prdis_surge_wave_damage&#39;,
       &#39;dislocated_surge_wave_damage&#39;, &#39;surge_wave_damage_exp&#39;,
       &#39;dsds3flag_surge_wave_damage&#39;, &#39;dsds0flag_surge_wave_damage&#39;,
       &#39;DS_0_wind_damage&#39;, &#39;DS_1_wind_damage&#39;, &#39;DS_2_wind_damage&#39;,
       &#39;DS_3_wind_damage&#39;, &#39;haz_expose_wind_damage&#39;, &#39;prdis_wind_damage&#39;,
       &#39;dislocated_wind_damage&#39;, &#39;wind_damage_exp&#39;, &#39;dsds3flag_wind_damage&#39;,
       &#39;dsds0flag_wind_damage&#39;, &#39;DS_0_flood_damage&#39;, &#39;DS_1_flood_damage&#39;,
       &#39;DS_2_flood_damage&#39;, &#39;DS_3_flood_damage&#39;, &#39;haz_expose_flood_damage&#39;,
       &#39;prdis_flood_damage&#39;, &#39;dislocated_flood_damage&#39;, &#39;flood_damage_exp&#39;,
       &#39;dsds3flag_flood_damage&#39;, &#39;dsds0flag_flood_damage&#39;, &#39;powerflag&#39;,
       &#39;transpoflag&#39;, &#39;powerflag_flood_damage&#39;, &#39;transpoflag_flood_damage&#39;,
       &#39;safeflag_flood_damage&#39;, &#39;powerflag_wind_damage&#39;,
       &#39;transpoflag_wind_damage&#39;, &#39;safeflag_wind_damage&#39;,
       &#39;powerflag_surge_wave_damage&#39;, &#39;transpoflag_surge_wave_damage&#39;,
       &#39;safeflag_surge_wave_damage&#39;, &#39;powerflag_combined_dmg&#39;,
       &#39;transpoflag_combined_dmg&#39;, &#39;safeflag_combined_dmg&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># loop through the damage types to consider dislocation due to power outage and road closure</span>
<span class="k">for</span> <span class="n">damage</span><span class="p">,</span> <span class="n">damage_result</span> <span class="ow">in</span> <span class="n">damage_types</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="c1"># update dislocation if powerflag &amp; transpoflag = 1</span>
    <span class="n">totaldislocation1</span> <span class="o">=</span> <span class="n">popdis_hhrs_df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;dislocated_</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">condition1</span> <span class="o">=</span> <span class="p">(</span><span class="n">popdis_hhrs_df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;powerflag_</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">condition2</span> <span class="o">=</span> <span class="p">(</span><span class="n">popdis_hhrs_df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;transpoflag_</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">popdis_hhrs_df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;dislocated_</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> \
        <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(((</span><span class="n">condition1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">condition2</span><span class="p">)),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">popdis_hhrs_df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;dislocated_</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">])</span>
    <span class="n">totaldislocation2</span> <span class="o">=</span> <span class="n">popdis_hhrs_df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;dislocated_</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">damage</span><span class="si">}</span><span class="s2"> Total number of dislocated households without and with power and tranportation effects: </span><span class="si">{</span><span class="n">totaldislocation1</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">totaldislocation2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>flood_damage Total number of dislocated households without and with power and tranportation effects: 8971 15351
wind_damage Total number of dislocated households without and with power and tranportation effects: 12715 16867
surge_wave_damage Total number of dislocated households without and with power and tranportation effects: 8909 14771
combined_dmg Total number of dislocated households without and with power and tranportation effects: 14288 18026
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Keep only columns needed for HHSR</span>
<span class="c1"># drop all columns with flag</span>
<span class="n">popdis_hhrs_df</span> <span class="o">=</span> <span class="n">popdis_hhrs_df</span><span class="p">[</span><span class="n">popdis_hhrs_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">popdis_hhrs_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="s1">&#39;flag&#39;</span><span class="p">)))]</span>
<span class="c1"># drop all columns with DS</span>
<span class="n">popdis_hhrs_df</span> <span class="o">=</span> <span class="n">popdis_hhrs_df</span><span class="p">[</span><span class="n">popdis_hhrs_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">popdis_hhrs_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="s1">&#39;DS&#39;</span><span class="p">)))]</span>
<span class="c1"># drop all columns with prdis</span>
<span class="n">popdis_hhrs_df</span> <span class="o">=</span> <span class="n">popdis_hhrs_df</span><span class="p">[</span><span class="n">popdis_hhrs_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">popdis_hhrs_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="s1">&#39;prdis&#39;</span><span class="p">)))]</span>
<span class="c1"># drop all columns with haz_expose</span>
<span class="n">popdis_hhrs_df</span> <span class="o">=</span> <span class="n">popdis_hhrs_df</span><span class="p">[</span><span class="n">popdis_hhrs_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">popdis_hhrs_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="s1">&#39;haz_expose&#39;</span><span class="p">)))]</span>
<span class="c1"># drop all columns with exp</span>
<span class="n">popdis_hhrs_df</span> <span class="o">=</span> <span class="n">popdis_hhrs_df</span><span class="p">[</span><span class="n">popdis_hhrs_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">popdis_hhrs_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="s1">&#39;exp&#39;</span><span class="p">)))]</span>
<span class="c1"># Drop column named dislocated </span>
<span class="c1"># popdis_hhrs_df = popdis_hhrs_df.drop(columns=[&#39;dislocated&#39;])</span>
<span class="n">popdis_hhrs_df</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;guid&#39;, &#39;average_power_back_time&#39;, &#39;average_transpo_back_time&#39;, &#39;huid&#39;,
       &#39;dislocated_combined_dmg&#39;, &#39;dislocated_surge_wave_damage&#39;,
       &#39;dislocated_wind_damage&#39;, &#39;dislocated_flood_damage&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Adding required columns for running the HHRS model from IN-CORE </span>
<span class="c1"># HHRS code in IN-CORE needs to be edited; race, hispan, ownershp data is no more required</span>
<span class="n">popdis_hhrs_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">right</span> <span class="o">=</span> <span class="n">popdis_results_df</span><span class="p">[</span><span class="n">damage</span><span class="p">][[</span><span class="s1">&#39;huid&#39;</span><span class="p">,</span><span class="s1">&#39;blockid&#39;</span><span class="p">,</span> <span class="s1">&#39;race&#39;</span><span class="p">,</span> <span class="s1">&#39;hispan&#39;</span><span class="p">,</span> <span class="s1">&#39;ownershp&#39;</span><span class="p">]],</span>
                          <span class="n">left</span> <span class="o">=</span> <span class="n">popdis_hhrs_df</span><span class="p">,</span>
                          <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;huid&#39;</span><span class="p">,</span>
                          <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;huid&#39;</span><span class="p">,</span>
                          <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">popdis_hhrs_df</span><span class="p">[</span><span class="s1">&#39;guid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count                                    33302
unique                                   22015
top       2669f722-ae95-4181-90a8-9c4755b7b29c
freq                                       191
Name: guid, dtype: object
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dislocated_types</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;dislocated_flood_damage&#39;</span><span class="p">,</span> <span class="s1">&#39;dislocated_wind_damage&#39;</span><span class="p">,</span> <span class="s1">&#39;dislocated_surge_wave_damage&#39;</span><span class="p">,</span> <span class="s1">&#39;dislocated_combined_dmg&#39;</span><span class="p">]</span>
<span class="n">hhrs_dislocation_dataset_names</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">dislocation</span> <span class="ow">in</span> <span class="n">dislocated_types</span><span class="p">:</span>
    <span class="n">popdis_hhrs_df_temp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">popdis_hhrs_df_temp</span> <span class="o">=</span> <span class="n">popdis_hhrs_df</span><span class="p">[[</span><span class="s1">&#39;guid&#39;</span><span class="p">,</span> <span class="s1">&#39;huid&#39;</span><span class="p">,</span> <span class="s1">&#39;blockid&#39;</span><span class="p">,</span> <span class="s1">&#39;race&#39;</span><span class="p">,</span> <span class="s1">&#39;hispan&#39;</span><span class="p">,</span> <span class="s1">&#39;ownershp&#39;</span><span class="p">,</span> <span class="n">dislocation</span><span class="p">]]</span>
    <span class="n">popdis_hhrs_df_temp</span> <span class="o">=</span> <span class="n">popdis_hhrs_df_temp</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">dislocation</span><span class="p">:</span> <span class="s1">&#39;dislocated&#39;</span><span class="p">})</span>
    <span class="n">popdis_hhrs_df_temp</span><span class="p">[</span><span class="s1">&#39;dislocated&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">popdis_hhrs_df_temp</span><span class="p">[</span><span class="s1">&#39;dislocated&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
    <span class="n">popdis_hhrs_dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_dataframe</span><span class="p">(</span><span class="n">popdis_hhrs_df_temp</span><span class="p">,</span>
                                             <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;popdis_hhrs_dataset_</span><span class="si">{</span><span class="n">dislocation</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                                             <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;incore:popDislocation&quot;</span><span class="p">)</span>
    <span class="n">hhrs_dislocation_dataset_names</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;popdis_hhrs_dataset_</span><span class="si">{</span><span class="n">dislocation</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">popdis_hhrs_dataset</span>
</pre></div>
</div>
</div>
</div>
<img src="https://ars.els-cdn.com/content/image/1-s2.0-S2772741623000388-gr6_lrg.jpg" width="700"/></section>
</section>
<section id="housing-household-recovery-sequentials">
<h2>8. Housing Household Recovery Sequentials<a class="headerlink" href="#housing-household-recovery-sequentials" title="Permalink to this heading">#</a></h2>
<section id="social-vulnerabilities">
<h3>8.1 Social vulnerabilities<a class="headerlink" href="#social-vulnerabilities" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># importing censusutils</span>
<span class="kn">from</span> <span class="nn">pyincore_data.censusutil</span> <span class="kn">import</span> <span class="n">CensusUtil</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Parameters</span>
<span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;texas&quot;</span>
<span class="n">county</span> <span class="o">=</span> <span class="s2">&quot;galveston&quot;</span>
<span class="n">year</span> <span class="o">=</span> <span class="mi">2019</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get fips code to use fetch census data</span>
<span class="n">fips</span> <span class="o">=</span> <span class="n">CensusUtil</span><span class="o">.</span><span class="n">get_fips_by_state_county</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">,</span> <span class="n">county</span><span class="o">=</span><span class="n">county</span><span class="p">)</span>
<span class="n">state_code</span> <span class="o">=</span> <span class="n">fips</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
<span class="n">county_code</span> <span class="o">=</span> <span class="n">fips</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">navs</span> <span class="o">=</span> <span class="n">CensusUtil</span><span class="o">.</span><span class="n">national_ave_values</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">year</span><span class="p">)</span>
<span class="n">national_vulnerability_feature_averages</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_csv_data</span><span class="p">(</span><span class="n">navs</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;national_vulnerability_feature_averages.csv&quot;</span><span class="p">,</span>
                                                                 <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;incore:socialVulnerabilityFeatureAverages&quot;</span><span class="p">)</span>

<span class="n">geo_type</span> <span class="o">=</span> <span class="s2">&quot;block</span><span class="si">%20g</span><span class="s2">roup:*&quot;</span>
<span class="c1"># geo_type = &quot;tract:*&quot;</span>
<span class="n">social_vulnerability_dem_factors_df</span> <span class="o">=</span> <span class="n">CensusUtil</span><span class="o">.</span><span class="n">demographic_factors</span><span class="p">(</span><span class="n">state_code</span><span class="p">,</span> <span class="n">county_code</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="n">year</span><span class="p">,</span>
                                                                      <span class="n">geo_type</span><span class="o">=</span><span class="n">geo_type</span><span class="p">)</span>

<span class="c1"># Temp fix: remove bad data point</span>
<span class="n">social_vulnerability_dem_factors_df</span> <span class="o">=</span> <span class="n">social_vulnerability_dem_factors_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="n">social_vulnerability_dem_factors</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_dataframe</span><span class="p">(</span><span class="n">social_vulnerability_dem_factors_df</span><span class="p">,</span>
                                                           <span class="n">name</span><span class="o">=</span><span class="s2">&quot;social_vunlnerability_dem_factors&quot;</span><span class="p">,</span>
                                                           <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;incore:socialVulnerabilityDemFactors&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>csv saved as api_20231215-014448.csv
csv saved as api_20231215-014449.csv
csv saved as api_20231215-014450.csv
csv saved as api_20231215-014451.csv
csv saved as api_20231215-014452.csv
csv saved as api_20231215-014453.csv
csv saved as api_20231215-014454.csv
csv saved as api_20231215-014455.csv
csv saved as api_20231215-014456.csv
csv saved as api_20231215-014457.csv
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">social_vulnerability</span> <span class="o">=</span> <span class="n">SocialVulnerability</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>

<span class="n">social_vulnerability</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;result_name&quot;</span><span class="p">,</span> <span class="s2">&quot;gal_social_vulnerabilty&quot;</span><span class="p">)</span>
<span class="n">social_vulnerability</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s2">&quot;national_vulnerability_feature_averages&quot;</span><span class="p">,</span> <span class="n">national_vulnerability_feature_averages</span><span class="p">)</span>
<span class="n">social_vulnerability</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s2">&quot;social_vulnerability_demographic_factors&quot;</span><span class="p">,</span> <span class="n">social_vulnerability_dem_factors</span><span class="p">)</span>

<span class="n">social_vulnerability</span><span class="o">.</span><span class="n">run_analysis</span><span class="p">()</span>
<span class="n">sv_result</span> <span class="o">=</span> <span class="n">social_vulnerability</span><span class="o">.</span><span class="n">get_output_dataset</span><span class="p">(</span><span class="s2">&quot;sv_result&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">sv_result</span><span class="o">.</span><span class="n">get_dataframe_from_csv</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="run-simulation">
<h3>8.2 Run simulation<a class="headerlink" href="#run-simulation" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Population dislocation result aggregated to the block group level.</span>
<span class="c1"># Transition probability matrix per social vulnerability level.</span>
<span class="n">transition_probability_matrix</span> <span class="o">=</span> <span class="s2">&quot;60f5e2ae544e944c3cec0794&quot;</span>
<span class="c1"># Initial mass probability function for stage 0.</span>
<span class="n">initial_probability_vector</span> <span class="o">=</span> <span class="s2">&quot;60f5e918544e944c3cec668b&quot;</span>

<span class="c1"># Create housing recovery instance</span>
<span class="n">housing_recovery</span> <span class="o">=</span> <span class="n">HousingRecoverySequential</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>

<span class="c1"># Load input datasets</span>
<span class="k">for</span> <span class="n">keys</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">hhrs_dislocation_dataset_names</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">housing_recovery</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s2">&quot;population_dislocation_block&quot;</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
    <span class="n">housing_recovery</span><span class="o">.</span><span class="n">load_remote_input_dataset</span><span class="p">(</span><span class="s2">&quot;tpm&quot;</span><span class="p">,</span> <span class="n">transition_probability_matrix</span><span class="p">)</span>
    <span class="n">housing_recovery</span><span class="o">.</span><span class="n">load_remote_input_dataset</span><span class="p">(</span><span class="s2">&quot;initial_stage_probabilities&quot;</span><span class="p">,</span> <span class="n">initial_probability_vector</span><span class="p">)</span> 
    
    <span class="c1"># Chain with SV output</span>
    <span class="n">housing_recovery</span><span class="o">.</span><span class="n">set_input_dataset</span><span class="p">(</span><span class="s1">&#39;sv_result&#39;</span><span class="p">,</span> <span class="n">sv_result</span><span class="p">)</span>

    <span class="c1"># Initial value to seed the random number generator to ensure replication</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="mi">1111</span>
    <span class="c1"># A size of the analysis time step.</span>
    <span class="n">t_delta</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="c1"># Total duration.</span>
    <span class="n">t_final</span> <span class="o">=</span> <span class="mf">90.0</span>    
    


    <span class="c1"># Specify the result name</span>
    <span class="n">result_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;housing_recovery_result_</span><span class="si">{</span><span class="n">keys</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># Set analysis parameters</span>
    <span class="n">housing_recovery</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;result_name&quot;</span><span class="p">,</span> <span class="n">result_name</span><span class="p">)</span>
    <span class="n">housing_recovery</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;seed&quot;</span><span class="p">,</span> <span class="n">seed</span><span class="p">)</span>
    <span class="n">housing_recovery</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;t_delta&quot;</span><span class="p">,</span> <span class="n">t_delta</span><span class="p">)</span>
    <span class="n">housing_recovery</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;t_final&quot;</span><span class="p">,</span> <span class="n">t_final</span><span class="p">)</span>
    <span class="n">housing_recovery</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="s2">&quot;num_cpu&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>

    <span class="n">housing_recovery</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    
    <span class="n">result</span> <span class="o">=</span> <span class="n">housing_recovery</span><span class="o">.</span><span class="n">get_output_dataset</span><span class="p">(</span><span class="s2">&quot;ds_result&quot;</span><span class="p">)</span>
    <span class="n">hh_stagehistory_df</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get_dataframe_from_csv</span><span class="p">()</span>
    <span class="c1">#timesteps = [&quot;1&quot;, &quot;7&quot;, &quot;13&quot;, &quot;25&quot;, &quot;85&quot;] # t0, t6, t12, t24, t84</span>
    <span class="n">timesteps</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="s2">&quot;4&quot;</span><span class="p">,</span> <span class="s2">&quot;5&quot;</span><span class="p">,</span> <span class="s2">&quot;6&quot;</span><span class="p">,</span> <span class="s2">&quot;7&quot;</span><span class="p">,</span> <span class="s2">&quot;13&quot;</span><span class="p">,</span> <span class="s2">&quot;25&quot;</span><span class="p">,</span> <span class="s2">&quot;37&quot;</span><span class="p">,</span> <span class="s2">&quot;49&quot;</span><span class="p">,</span> <span class="s2">&quot;61&quot;</span><span class="p">,</span> <span class="s2">&quot;73&quot;</span><span class="p">,</span> <span class="s2">&quot;85&quot;</span><span class="p">]</span>
    <span class="n">HHRSOutputProcess</span><span class="o">.</span><span class="n">get_hhrs_stage_count</span><span class="p">(</span><span class="n">timesteps</span><span class="p">,</span> <span class="n">hh_stagehistory_df</span><span class="p">,</span>
                                           <span class="n">filename_json</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;hhrs_stage_count_</span><span class="si">{</span><span class="n">keys</span><span class="si">}</span><span class="s2">.json&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
Dataset already exists locally. Reading from local cached zip.
Unzipped folder found in the local cache. Reading from it...
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hh_stagehistory_df</span><span class="p">[</span><span class="s1">&#39;guid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count                                    33302
unique                                   22015
top       2669f722-ae95-4181-90a8-9c4755b7b29c
freq                                       191
Name: guid, dtype: object
</pre></div>
</div>
</div>
</div>
</section>
<section id="results-multi-hazard">
<h3>8.3 Results: multi-hazard<a class="headerlink" href="#results-multi-hazard" title="Permalink to this heading">#</a></h3>
<img src="https://ars.els-cdn.com/content/image/1-s2.0-S2772741623000388-gr9_lrg.jpg" width="700"/>
</section>
<section id="results-infrastructure">
<h3>8.3 Results: infrastructure<a class="headerlink" href="#results-infrastructure" title="Permalink to this heading">#</a></h3>
<img src="https://ars.els-cdn.com/content/image/1-s2.0-S2772741623000388-gr10_lrg.jpg" width="700"/></section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "npr99/IN-CORE_Galveston",
            ref: "kooshan_main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prerequisites">1. Prerequisites</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#load-packages">1.1 Load packages</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#define-hazard">1.2 Define hazard</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#define-inventory">1.3 Define inventory</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#buildings">1.3.1 Buildings</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#power-infrastructure">1.3.2 Power infrastructure</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#transportation-infrastructure">1.3.3 Transportation infrastructure</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#paper-figure">1.3.4 Paper figure</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#combined-building-damage">2. Combined building damage</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#wind-building-damage">2.1 Wind building damage</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#surge-wave-building-damage">2.2 Surge-Wave building damage</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inundation-flood-building-damage">2.3 Inundation (flood) building damage</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#combine-wind-surge-wave-and-flood-building-damage">2.4 Combine wind, surge-wave and flood building damage</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#hazard-exposure-example-surge-wave">2.4.1 Hazard exposure example: surge-wave</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#combined-damage-setup">2.4.2 Combined damage: setup</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#hazard-exposure-example-combined">2.4.3 Hazard exposure example: combined</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#archetype-mapping">2.5 Archetype mapping</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-results">2.6 Plot results</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">2.6.1 Combined building damage</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">2.6.2 Paper figure</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#electric-power-pole-damage">3. Electric Power Pole Damage</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#monte-carlo-sampling">4. Monte Carlo sampling</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">4.1 Buildings</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#electric-power-poles">4.2 Electric power poles</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#building-functionality">5. Building functionality</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#capital-shocks">6. Capital Shocks</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#population-dislocation-multihazard-comparison">7. Population dislocation - Multihazard Comparison</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setup-general-population-data">7.1 Setup general population data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#initial-loop-for-dislocation">7.2 Initial loop for dislocation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#clean-and-merge-dislocation-data">7.3 Clean and merge dislocation data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#merge-in-infrastructure-analyses-on-transportation-and-power">7.4 Merge in infrastructure analyses on transportation and power</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#add-flag-for-power-outage-and-road-closure">7.5 Add Flag for Power Outage and Road Closure</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#modify-dislocation-for-hhsr">7.6 Modify dislocation for HHSR</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#housing-household-recovery-sequentials">8. Housing Household Recovery Sequentials</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#social-vulnerabilities">8.1 Social vulnerabilities</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#run-simulation">8.2 Run simulation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#results-multi-hazard">8.3 Results: multi-hazard</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#results-infrastructure">8.3 Results: infrastructure</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Kooshan Amini
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>